

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>sndlib &mdash; pychoacoustics (&#39;0.2.52&#39;,) documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '(&#39;0.2.52&#39;,)',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="pychoacoustics (&#39;0.2.52&#39;,) documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">pychoacoustics (&#39;0.2.52&#39;,) documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for sndlib</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c">#   Copyright (C) 2008-2013 Samuele Carcagno &lt;sam.carcagno@gmail.com&gt;</span>
<span class="c">#   This file is part of sndlib</span>

<span class="c">#    sndlib is free software: you can redistribute it and/or modify</span>
<span class="c">#    it under the terms of the GNU General Public License as published by</span>
<span class="c">#    the Free Software Foundation, either version 3 of the License, or</span>
<span class="c">#    (at your option) any later version.</span>

<span class="c">#    sndlib is distributed in the hope that it will be useful,</span>
<span class="c">#    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c">#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c">#    GNU General Public License for more details.</span>

<span class="c">#    You should have received a copy of the GNU General Public License</span>
<span class="c">#    along with sndlib.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A module for generating sounds in python.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">nested_scopes</span><span class="p">,</span> <span class="n">generators</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">with_statement</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="kn">import</span> <span class="nn">copy</span><span class="o">,</span> <span class="nn">numpy</span><span class="o">,</span> <span class="nn">multiprocessing</span><span class="o">,</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">ceil</span><span class="p">,</span> <span class="n">cumsum</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">log2</span><span class="p">,</span> <span class="n">log10</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="nb">abs</span><span class="p">,</span> <span class="n">arange</span><span class="p">,</span> <span class="n">zeros</span><span class="p">,</span> <span class="n">ones</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">convolve</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">real</span><span class="p">,</span> <span class="n">int_</span><span class="p">,</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">repeat</span><span class="p">,</span> <span class="n">logspace</span><span class="p">,</span> <span class="n">concatenate</span>
<span class="kn">from</span> <span class="nn">numpy.fft</span> <span class="kn">import</span> <span class="n">rfft</span><span class="p">,</span> <span class="n">irfft</span><span class="p">,</span> <span class="n">fft</span><span class="p">,</span> <span class="n">ifft</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">firwin2</span>


<div class="viewcode-block" id="addSounds"><a class="viewcode-back" href="../index.html#sndlib.addSounds">[docs]</a><span class="k">def</span> <span class="nf">addSounds</span><span class="p">(</span><span class="n">snd1</span><span class="p">,</span> <span class="n">snd2</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add or concatenate two sounds.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    snd1 : array of floats</span>
<span class="sd">        First sound.</span>
<span class="sd">    snd2 : array of floats</span>
<span class="sd">        Second sound.</span>
<span class="sd">    delay : float</span>
<span class="sd">        Delay in milliseconds between the onset of &#39;snd1&#39; and the onset of &#39;snd2&#39;</span>
<span class="sd">    fs : float</span>
<span class="sd">        Sampling frequency in hertz of the two sounds.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; snd1 = pureTone(frequency=440, phase=0, level=65, duration=180,</span>
<span class="sd">    ...     ramp=10, channel=&#39;Right&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">    &gt;&gt;&gt; snd2 = pureTone(frequency=880, phase=0, level=65, duration=180,</span>
<span class="sd">    ...     ramp=10, channel=&#39;Right&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">    &gt;&gt;&gt; snd = addSounds(snd1=snd1, snd2=snd2, delay=100, fs=48000)</span>
<span class="sd">    &quot;&quot;&quot;</span>
  
    <span class="c">#delay in ms</span>
    <span class="n">delay</span> <span class="o">=</span> <span class="n">delay</span> <span class="o">/</span> <span class="mf">1000.</span> <span class="c">#convert from ms to sec</span>

    <span class="n">nSnd1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">snd1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">nSnd2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">snd2</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">snd1Duration</span> <span class="o">=</span> <span class="n">nSnd1</span><span class="o">/</span><span class="n">fs</span>
    <span class="n">snd2Duration</span> <span class="o">=</span> <span class="n">nSnd2</span><span class="o">/</span><span class="n">fs</span>

    <span class="c">#------------------------</span>
    <span class="c">#            ...............................</span>

    <span class="c"># Seg1           Seg2              Seg3</span>
    
    <span class="n">nSampSeg1</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">delay</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nSampSeg1</span> <span class="o">&lt;</span> <span class="n">nSnd1</span><span class="p">:</span>
        <span class="n">nSampSeg2</span> <span class="o">=</span> <span class="n">nSnd1</span> <span class="o">-</span> <span class="n">nSampSeg1</span>
        <span class="n">nSampSeg3</span> <span class="o">=</span> <span class="n">nSnd2</span> <span class="o">-</span> <span class="n">nSampSeg2</span>
        <span class="n">seg1</span> <span class="o">=</span> <span class="n">snd1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nSampSeg1</span><span class="p">,:]</span>
        <span class="n">seg2a</span> <span class="o">=</span> <span class="n">snd1</span><span class="p">[</span><span class="n">nSampSeg1</span><span class="p">:</span><span class="n">nSnd1</span><span class="p">,:]</span>
        <span class="k">if</span> <span class="n">nSampSeg2</span> <span class="o">&gt;</span> <span class="n">nSnd2</span><span class="p">:</span> <span class="c"># snd2 shorter than seg2, fill with zeros</span>
            <span class="n">ldiff</span> <span class="o">=</span> <span class="n">nSampSeg2</span> <span class="o">-</span> <span class="n">nSnd2</span>
            <span class="n">diffSeg</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">ldiff</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">seg2b</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">((</span><span class="n">snd2</span><span class="p">,</span> <span class="n">diffSeg</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">seg2b</span> <span class="o">=</span> <span class="n">snd2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nSampSeg2</span><span class="p">,:]</span>
            <span class="n">seg3</span> <span class="o">=</span> <span class="n">snd2</span><span class="p">[</span><span class="n">nSampSeg2</span><span class="p">:</span><span class="n">nSnd2</span><span class="p">,:]</span>

        <span class="n">seg2</span> <span class="o">=</span> <span class="n">seg2a</span><span class="o">+</span><span class="n">seg2b</span>
        <span class="n">snd</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">((</span><span class="n">seg1</span><span class="p">,</span> <span class="n">seg2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">nSampSeg2</span> <span class="o">&lt;</span> <span class="n">nSnd2</span><span class="p">:</span>
            <span class="n">snd</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">((</span><span class="n">snd</span><span class="p">,</span> <span class="n">seg3</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            
    <span class="k">else</span><span class="p">:</span>
        <span class="n">seg1</span> <span class="o">=</span> <span class="n">snd1</span>
        <span class="n">seg2</span> <span class="o">=</span> <span class="n">makeSilence</span><span class="p">((</span><span class="n">delay</span> <span class="o">-</span> <span class="n">snd1Duration</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
        <span class="n">seg3</span> <span class="o">=</span> <span class="n">snd2</span>
        <span class="n">snd</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">((</span><span class="n">seg1</span><span class="p">,</span> <span class="n">seg2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">snd</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">((</span><span class="n">snd</span><span class="p">,</span> <span class="n">seg3</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
    <span class="k">return</span><span class="p">(</span><span class="n">snd</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="AMTone"><a class="viewcode-back" href="../index.html#sndlib.AMTone">[docs]</a><span class="k">def</span> <span class="nf">AMTone</span><span class="p">(</span><span class="n">frequency</span><span class="p">,</span> <span class="n">AMFreq</span><span class="p">,</span> <span class="n">AMDepth</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate an amplitude modulated tone.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    frequency : float</span>
<span class="sd">        Carrier frequency in hertz.</span>
<span class="sd">    AMFreq : float</span>
<span class="sd">        Amplitude modulation frequency in Hz.</span>
<span class="sd">    AMDepth : float</span>
<span class="sd">        Amplitude modulation depth (a value of 1</span>
<span class="sd">        corresponds to 100% modulation). </span>
<span class="sd">    phase : float</span>
<span class="sd">        Starting phase in radians.</span>
<span class="sd">    level : float</span>
<span class="sd">        Tone level in dB SPL. </span>
<span class="sd">    duration : float</span>
<span class="sd">        Tone duration (excluding ramps) in milliseconds.</span>
<span class="sd">    ramp : float</span>
<span class="sd">        Duration of the onset and offset ramps in milliseconds.</span>
<span class="sd">        The total duration of the sound will be duration+ramp*2.</span>
<span class="sd">    channel : string (&#39;Right&#39;, &#39;Left&#39; or &#39;Both&#39;)</span>
<span class="sd">        Channel in which the tone will be generated.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>
<span class="sd">    maxLevel : float</span>
<span class="sd">        Level in dB SPL output by the soundcard for a sinusoid of amplitude 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; snd = AMTone(frequency=1000, AMFreq=20, AMDepth=1, phase=0, level=65, duration=180,</span>
<span class="sd">    ...     ramp=10, channel=&#39;Both&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">amp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">level</span> <span class="o">-</span> <span class="n">maxLevel</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c">#convert from ms to sec</span>
    <span class="n">ramp</span> <span class="o">=</span> <span class="n">ramp</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nRamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ramp</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nTot</span> <span class="o">=</span> <span class="n">nSamples</span> <span class="o">+</span> <span class="p">(</span><span class="n">nRamp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">timeAll</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">nTot</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>
    <span class="n">timeRamp</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">nRamp</span><span class="p">)</span> 

    <span class="n">snd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">AMDepth</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">AMFreq</span><span class="o">*</span><span class="n">timeAll</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">AMDepth</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">AMFreq</span><span class="o">*</span><span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]))</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">AMDepth</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">AMFreq</span><span class="o">*</span><span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">AMDepth</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">AMFreq</span><span class="o">*</span><span class="n">timeAll</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">AMDepth</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">AMFreq</span><span class="o">*</span><span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]))</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">AMDepth</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">AMFreq</span><span class="o">*</span><span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">AMDepth</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">AMFreq</span><span class="o">*</span><span class="n">timeAll</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">AMDepth</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">AMFreq</span><span class="o">*</span><span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]))</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">AMDepth</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">AMFreq</span><span class="o">*</span><span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">snd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> 
       
    <span class="k">return</span> <span class="n">snd</span>
</div>
<div class="viewcode-block" id="binauralPureTone"><a class="viewcode-back" href="../index.html#sndlib.binauralPureTone">[docs]</a><span class="k">def</span> <span class="nf">binauralPureTone</span><span class="p">(</span><span class="n">frequency</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">itd</span><span class="p">,</span> <span class="n">itdRef</span><span class="p">,</span> <span class="n">ild</span><span class="p">,</span> <span class="n">ildRef</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a pure tone with an optional interaural time or level difference.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    frequency : float</span>
<span class="sd">        Tone frequency in hertz.</span>
<span class="sd">    phase : float</span>
<span class="sd">        Starting phase in radians.</span>
<span class="sd">    level : float</span>
<span class="sd">        Tone level in dB SPL. If &#39;ild&#39; is different than zero, this will</span>
<span class="sd">        be the level of the tone in the reference channel.</span>
<span class="sd">    duration : float</span>
<span class="sd">        Tone duration (excluding ramps) in milliseconds.</span>
<span class="sd">    ramp : float</span>
<span class="sd">        Duration of the onset and offset ramps in milliseconds.</span>
<span class="sd">        The total duration of the sound will be duration+ramp*2.</span>
<span class="sd">    channel : string (&#39;Right&#39;, &#39;Left&#39; or &#39;Both&#39;)</span>
<span class="sd">        Channel in which the tone will be generated.</span>
<span class="sd">    itd : float</span>
<span class="sd">        Interaural time difference, in microseconds.</span>
<span class="sd">    itdRef : &#39;Right&#39;, &#39;Left&#39; or None</span>
<span class="sd">        The reference channel for the &#39;itd&#39;. The interaural time</span>
<span class="sd">        difference will be applied to the other channel with</span>
<span class="sd">        respect to the reference channel.</span>
<span class="sd">    ild : float</span>
<span class="sd">        Interaural level difference in dB SPL.</span>
<span class="sd">    ildRef : &#39;Right&#39;, &#39;Left&#39; or None</span>
<span class="sd">        The reference channel for the &#39;ild&#39;.</span>
<span class="sd">        The level of the other channel will be</span>
<span class="sd">        icreased of attenuated by &#39;ild&#39; dB SPL</span>
<span class="sd">        with respect to the reference channel.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>
<span class="sd">    maxLevel : float</span>
<span class="sd">        Level in dB SPL output by the soundcard for a sinusoid of amplitude 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">        The array has dimensions (nSamples, 2).</span>
<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; itdTone = binauralPureTone(frequency=440, phase=0, level=65, duration=180,</span>
<span class="sd">    ...     ramp=10, channel=&#39;Both&#39;, itd=480, itdRef=&#39;Right&#39;, ild=0, ildRef=None,</span>
<span class="sd">    ...     fs=48000, maxLevel=100)</span>
<span class="sd">    &gt;&gt;&gt; ildTone = binauralPureTone(frequency=440, phase=0, level=65, duration=180,</span>
<span class="sd">    ...     ramp=10, channel=&#39;Both&#39;, itd=0, itdRef=None, ild=-20, ildRef=&#39;Right&#39;,</span>
<span class="sd">    ...     fs=48000, maxLevel=100)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">channel</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;Right&quot;</span><span class="p">,</span> <span class="s">&quot;Left&quot;</span><span class="p">,</span> <span class="s">&quot;Both&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid channel argument. Channel must be one of &#39;Right&#39;, &#39;Left&#39; or &#39;Both&#39;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">itdRef</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;Right&quot;</span><span class="p">,</span> <span class="s">&quot;Left&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid &#39;itdRef&#39; argument. &#39;itdRef&#39; must be one of &#39;Right&#39;, &#39;Left&#39; or None&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ildRef</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;Right&quot;</span><span class="p">,</span> <span class="s">&quot;Left&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid &#39;ildRef&#39; argument. &#39;ildRef&#39; must be one of &#39;Right&#39;, &#39;Left&#39; or None&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">itd</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">itdRef</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;&#39;itd&#39; is different than zero but no &#39;itdRef&#39; was given. No &#39;itd&#39; will be applied.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ild</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ildRef</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;&#39;ild&#39; is different than zero but no &#39;ildRef&#39; was given. No &#39;ild&#39; will be applied.&quot;</span><span class="p">)</span>

    
    <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&#39;Both&#39;</span><span class="p">:</span>
        <span class="n">ipd</span> <span class="o">=</span> <span class="n">itdtoipd</span><span class="p">(</span><span class="n">itd</span><span class="o">/</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">frequency</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ildRef</span> <span class="o">==</span> <span class="s">&#39;Right&#39;</span><span class="p">:</span>
            <span class="n">ampRight</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">level</span> <span class="o">-</span> <span class="n">maxLevel</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
            <span class="n">ampLeft</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">level</span> <span class="o">+</span> <span class="n">ild</span> <span class="o">-</span> <span class="n">maxLevel</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ildRef</span> <span class="o">==</span> <span class="s">&#39;Left&#39;</span><span class="p">:</span>
            <span class="n">ampLeft</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">level</span> <span class="o">-</span> <span class="n">maxLevel</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
            <span class="n">ampRight</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">level</span> <span class="o">+</span> <span class="n">ild</span> <span class="o">-</span> <span class="n">maxLevel</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ildRef</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ampRight</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">level</span> <span class="o">-</span> <span class="n">maxLevel</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
            <span class="n">ampLeft</span> <span class="o">=</span> <span class="n">ampRight</span>

        <span class="k">if</span> <span class="n">itdRef</span> <span class="o">==</span> <span class="s">&#39;Right&#39;</span><span class="p">:</span>
            <span class="n">phaseRight</span> <span class="o">=</span> <span class="n">phase</span>
            <span class="n">phaseLeft</span> <span class="o">=</span> <span class="n">phase</span> <span class="o">+</span> <span class="n">ipd</span>
        <span class="k">elif</span> <span class="n">itdRef</span> <span class="o">==</span> <span class="s">&#39;Left&#39;</span><span class="p">:</span>
            <span class="n">phaseLeft</span> <span class="o">=</span> <span class="n">phase</span>
            <span class="n">phaseRight</span> <span class="o">=</span> <span class="n">phase</span> <span class="o">+</span> <span class="n">ipd</span>
        <span class="k">elif</span> <span class="n">itdRef</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">phaseRight</span> <span class="o">=</span> <span class="n">phase</span>
            <span class="n">phaseLeft</span> <span class="o">=</span> <span class="n">phase</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">amp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">level</span> <span class="o">-</span> <span class="n">maxLevel</span><span class="p">)</span> <span class="o">/</span> <span class="mf">20.</span><span class="p">)</span>
            
    <span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mf">1000.</span> <span class="c">#convert from ms to sec</span>
    <span class="n">ramp</span> <span class="o">=</span> <span class="n">ramp</span> <span class="o">/</span> <span class="mf">1000.</span>

    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nRamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ramp</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nTot</span> <span class="o">=</span> <span class="n">nSamples</span> <span class="o">+</span> <span class="p">(</span><span class="n">nRamp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">timeAll</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">nTot</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>
    <span class="n">timeRamp</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">nRamp</span><span class="p">)</span> 

    <span class="n">snd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>


    <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ampLeft</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span> <span class="o">+</span> <span class="n">phaseLeft</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ampLeft</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span> <span class="o">+</span> <span class="n">phaseLeft</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ampLeft</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span> <span class="o">+</span> <span class="n">phaseLeft</span><span class="p">)</span>

        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ampRight</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span> <span class="o">+</span> <span class="n">phaseRight</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ampRight</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span> <span class="o">+</span> <span class="n">phaseRight</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ampRight</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span> <span class="o">+</span> <span class="n">phaseRight</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">snd</span>

</div>
<div class="viewcode-block" id="broadbandNoise"><a class="viewcode-back" href="../index.html#sndlib.broadbandNoise">[docs]</a><span class="k">def</span> <span class="nf">broadbandNoise</span><span class="p">(</span><span class="n">spectrumLevel</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Synthetise a broadband noise.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    spectrumLevel : float</span>
<span class="sd">        Intensity spectrum level of the noise in dB SPL. </span>
<span class="sd">    duration : float</span>
<span class="sd">        Noise duration (excluding ramps) in milliseconds.</span>
<span class="sd">    ramp : float</span>
<span class="sd">        Duration of the onset and offset ramps in milliseconds.</span>
<span class="sd">        The total duration of the sound will be duration+ramp*2.</span>
<span class="sd">    channel : string (&#39;Right&#39;, &#39;Left&#39; or &#39;Both&#39;)</span>
<span class="sd">        Channel in which the noise will be generated.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>
<span class="sd">    maxLevel : float</span>
<span class="sd">        Level in dB SPL output by the soundcard for a sinusoid of amplitude 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">        The array has dimensions (nSamples, 2).</span>
<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; noise = broadbandNoise(spectrumLevel=40, duration=180, ramp=10,</span>
<span class="sd">    ...     channel=&#39;Both&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="sd">&quot;&quot;&quot; Comments:.</span>
<span class="sd">    The intensity spectrum level in dB is SL</span>
<span class="sd">    The peak amplitude A to achieve a desired SL is</span>
<span class="sd">    SL = 10*log10(RMS^2/NHz) that is the total RMS^2 divided by the freq band</span>
<span class="sd">    SL/10 = log10(RMS^2/NHz)</span>
<span class="sd">    10^(SL/10) = RMS^2/NHz</span>
<span class="sd">    RMS^2 = 10^(SL/10) * NHz</span>
<span class="sd">    RMS = 10^(SL/20) * sqrt(NHz)</span>
<span class="sd">    NHz = sampRate / 2 (Nyquist)</span>
<span class="sd">    </span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">amp</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">fs</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">spectrumLevel</span> <span class="o">-</span> <span class="n">maxLevel</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">))</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c">#convert from ms to sec</span>
    <span class="n">ramp</span> <span class="o">=</span> <span class="n">ramp</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nRamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ramp</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nTot</span> <span class="o">=</span> <span class="n">nSamples</span> <span class="o">+</span> <span class="p">(</span><span class="n">nRamp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">timeAll</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nTot</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>
    <span class="n">timeRamp</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nRamp</span><span class="p">)</span> 

    <span class="n">snd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="c">#random is a numpy module</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">nTot</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">nTot</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">nTot</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">nTot</span><span class="p">))</span>
    <span class="n">RMS</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">noise</span><span class="o">*</span><span class="n">noise</span><span class="p">))</span>
    <span class="c">#scale the noise so that the maxAmplitude goes from -1 to 1</span>
    <span class="c">#since A = RMS*sqrt(2)</span>
    <span class="n">scaled_noise</span> <span class="o">=</span> <span class="n">noise</span> <span class="o">/</span> <span class="p">(</span><span class="n">RMS</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>


    <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">snd</span>

</div>
<div class="viewcode-block" id="chirp"><a class="viewcode-back" href="../index.html#sndlib.chirp">[docs]</a><span class="k">def</span> <span class="nf">chirp</span><span class="p">(</span><span class="n">freqStart</span><span class="p">,</span> <span class="n">ftype</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Synthetize a chirp, that is a tone with frequency changing linearly or</span>
<span class="sd">    exponentially over time with a give rate.</span>
<span class="sd">    </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    freqStart : float</span>
<span class="sd">        Starting frequency in hertz.</span>
<span class="sd">    ftype : string</span>
<span class="sd">        If &#39;linear&#39;, the frequency will change linearly on a Hz scale.</span>
<span class="sd">        If &#39;exponential&#39;, the frequency will change exponentially on a cents scale.</span>
<span class="sd">    rate : float</span>
<span class="sd">        Rate of frequency change, Hz/s if ftype is &#39;linear&#39;,</span>
<span class="sd">        and cents/s if ftype is &#39;exponential&#39;.</span>
<span class="sd">    level : float</span>
<span class="sd">        Level of the tone in dB SPL.</span>
<span class="sd">    duration : float</span>
<span class="sd">        Tone duration (excluding ramps) in milliseconds.</span>
<span class="sd">    ramp : float</span>
<span class="sd">        Duration of the onset and offset ramps in milliseconds.</span>
<span class="sd">        The total duration of the sound will be duration+ramp*2.</span>
<span class="sd">    channel : string (&#39;Right&#39;, &#39;Left&#39; or &#39;Both&#39;)</span>
<span class="sd">        Channel in which the tone will be generated.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>
<span class="sd">    maxLevel : float</span>
<span class="sd">        Level in dB SPL output by the soundcard for a sinusoid of amplitude 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">        The array has dimensions (nSamples, 2).</span>
<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; gl = chirp(freqStart=440, ftype=&#39;linear&#39;, rate=500, level=55,</span>
<span class="sd">            duration=980, phase=0, ramp=10, channel=&#39;Both&#39;,</span>
<span class="sd">            fs=48000, maxLevel=100)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">amp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">level</span> <span class="o">-</span> <span class="n">maxLevel</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c">#convert from ms to sec</span>
    <span class="n">ramp</span> <span class="o">=</span> <span class="n">ramp</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="n">totDur</span> <span class="o">=</span> <span class="n">duration</span><span class="o">+</span><span class="n">ramp</span><span class="o">*</span><span class="mi">2</span>
    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nRamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ramp</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nTot</span> <span class="o">=</span> <span class="n">nSamples</span> <span class="o">+</span> <span class="p">(</span><span class="n">nRamp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">timeAll</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nTot</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>
    <span class="n">timeRamp</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nRamp</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ftype</span> <span class="o">==</span> <span class="s">&quot;exponential&quot;</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">rate</span><span class="o">/</span><span class="mi">1200</span><span class="p">)</span>
        <span class="n">frequency</span> <span class="o">=</span> <span class="n">freqStart</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span> <span class="p">(</span> <span class="p">(</span><span class="n">k</span><span class="o">**</span><span class="n">timeAll</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">elif</span> <span class="n">ftype</span> <span class="o">==</span> <span class="s">&quot;linear&quot;</span><span class="p">:</span>
        <span class="n">frequency</span> <span class="o">=</span> <span class="n">freqStart</span><span class="o">*</span><span class="n">timeAll</span> <span class="o">+</span> <span class="p">(</span><span class="n">rate</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">timeAll</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">phase</span>
        

    <span class="n">snd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">])</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)])</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">])</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)])</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">])</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)])</span>
        <span class="n">snd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">snd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> 

    <span class="k">return</span> <span class="n">snd</span>

</div>
<div class="viewcode-block" id="complexTone"><a class="viewcode-back" href="../index.html#sndlib.complexTone">[docs]</a><span class="k">def</span> <span class="nf">complexTone</span><span class="p">(</span><span class="n">F0</span><span class="p">,</span> <span class="n">harmPhase</span><span class="p">,</span> <span class="n">lowHarm</span><span class="p">,</span> <span class="n">highHarm</span><span class="p">,</span> <span class="n">stretch</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Synthetise a complex tone.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    F0 : float</span>
<span class="sd">        Tone fundamental frequency in hertz.</span>
<span class="sd">    harmPhase : one of &#39;Sine&#39;, &#39;Cosine&#39;, &#39;Alternating&#39;, &#39;Random&#39;, &#39;Schroeder&#39;</span>
<span class="sd">        Phase relationship between the partials of the complex tone.</span>
<span class="sd">    lowHarm : int</span>
<span class="sd">        Lowest harmonic component number.</span>
<span class="sd">    highHarm : int</span>
<span class="sd">        Highest harmonic component number.</span>
<span class="sd">    stretch : float</span>
<span class="sd">        Harmonic stretch in %F0. Increase each harmonic frequency by a fixed value</span>
<span class="sd">        that is equal to (F0*stretch)/100. If &#39;stretch&#39; is different than</span>
<span class="sd">        zero, an inhanmonic complex tone will be generated.</span>
<span class="sd">    level : float</span>
<span class="sd">        The level of each partial in dB SPL.</span>
<span class="sd">    duration : float</span>
<span class="sd">        Tone duration (excluding ramps) in milliseconds.</span>
<span class="sd">    ramp : float</span>
<span class="sd">        Duration of the onset and offset ramps in milliseconds.</span>
<span class="sd">        The total duration of the sound will be duration+ramp*2.</span>
<span class="sd">    channel : &#39;Right&#39;, &#39;Left&#39;, &#39;Both&#39;, &#39;Odd Right&#39; or &#39;Odd Left&#39;</span>
<span class="sd">        Channel in which the tone will be generated. If &#39;channel&#39;</span>
<span class="sd">        if &#39;Odd Right&#39;, odd numbered harmonics will be presented</span>
<span class="sd">        to the right channel and even number harmonics to the left</span>
<span class="sd">        channel. The opposite is true if &#39;channel&#39; is &#39;Odd Left&#39;.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>
<span class="sd">    maxLevel : float</span>
<span class="sd">        Level in dB SPL output by the soundcard for a sinusoid of amplitude 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">        The array has dimensions (nSamples, 2).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; ct = complexTone(F0=440, harmPhase=&#39;Sine&#39;, lowHarm=3, highHarm=10,</span>
<span class="sd">    ...     stretch=0, level=55, duration=180, ramp=10, channel=&#39;Both&#39;,</span>
<span class="sd">    ...     fs=48000, maxLevel=100)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">amp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">level</span> <span class="o">-</span> <span class="n">maxLevel</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mf">1000.</span> <span class="c">#convert from ms to sec</span>
    <span class="n">ramp</span> <span class="o">=</span> <span class="n">ramp</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="n">stretchHz</span> <span class="o">=</span> <span class="p">(</span><span class="n">F0</span><span class="o">*</span><span class="n">stretch</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span>
    
    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nRamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ramp</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nTot</span> <span class="o">=</span> <span class="n">nSamples</span> <span class="o">+</span> <span class="p">(</span><span class="n">nRamp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    
    <span class="n">timeAll</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nTot</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>
    <span class="n">timeRamp</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nRamp</span><span class="p">)</span> 

    <span class="n">snd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
        <span class="n">tone</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">nTot</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Left&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Right&quot;</span><span class="p">:</span>
        <span class="n">toneOdd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">nTot</span><span class="p">)</span>
        <span class="n">toneEven</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">nTot</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">harmPhase</span> <span class="o">==</span> <span class="s">&quot;Sine&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lowHarm</span><span class="p">,</span> <span class="n">highHarm</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
                <span class="n">tone</span> <span class="o">=</span>  <span class="n">tone</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">((</span><span class="n">F0</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">stretchHz</span><span class="p">)</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Left&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Right&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c">#odd harmonic</span>
                    <span class="n">toneOdd</span> <span class="o">=</span> <span class="n">toneOdd</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">((</span><span class="n">F0</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">stretchHz</span><span class="p">)</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">toneEven</span> <span class="o">=</span> <span class="n">toneEven</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">((</span><span class="n">F0</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">stretchHz</span><span class="p">)</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">harmPhase</span> <span class="o">==</span> <span class="s">&quot;Cosine&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lowHarm</span><span class="p">,</span> <span class="n">highHarm</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
                <span class="n">tone</span> <span class="o">=</span> <span class="n">tone</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">((</span><span class="n">F0</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">stretchHz</span><span class="p">)</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Left&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Right&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c">#odd harmonic</span>
                    <span class="n">toneOdd</span> <span class="o">=</span> <span class="n">toneOdd</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">((</span><span class="n">F0</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">stretchHz</span><span class="p">)</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">toneEven</span> <span class="o">=</span> <span class="n">toneEven</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">((</span><span class="n">F0</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">stretchHz</span><span class="p">)</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">harmPhase</span> <span class="o">==</span> <span class="s">&quot;Alternating&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lowHarm</span><span class="p">,</span> <span class="n">highHarm</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c">#odd harmonic</span>
                <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
                    <span class="n">tone</span> <span class="o">=</span> <span class="n">tone</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">((</span><span class="n">F0</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">stretchHz</span><span class="p">)</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Left&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Right&quot;</span><span class="p">:</span>
                    <span class="n">toneOdd</span> <span class="o">=</span> <span class="n">toneOdd</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">((</span><span class="n">F0</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">stretchHz</span><span class="p">)</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="c">#even harmonic</span>
                <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
                    <span class="n">tone</span> <span class="o">=</span> <span class="n">tone</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">((</span><span class="n">F0</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">stretchHz</span><span class="p">)</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Left&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Right&quot;</span><span class="p">:</span>
                    <span class="n">toneEven</span> <span class="o">=</span> <span class="n">toneEven</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">((</span><span class="n">F0</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">stretchHz</span><span class="p">)</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">harmPhase</span> <span class="o">==</span> <span class="s">&quot;Schroeder&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lowHarm</span><span class="p">,</span> <span class="n">highHarm</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="o">-</span><span class="n">pi</span> <span class="o">*</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">highHarm</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
                <span class="n">tone</span> <span class="o">=</span> <span class="n">tone</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">((</span><span class="n">F0</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">stretchHz</span><span class="p">)</span> <span class="o">*</span> <span class="n">timeAll</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Left&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Right&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c">#odd harmonic</span>
                    <span class="n">toneOdd</span> <span class="o">=</span> <span class="n">toneOdd</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">((</span><span class="n">F0</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">stretchHz</span><span class="p">)</span> <span class="o">*</span> <span class="n">timeAll</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">toneEven</span> <span class="o">=</span> <span class="n">toneEven</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">((</span><span class="n">F0</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">stretchHz</span><span class="p">)</span> <span class="o">*</span> <span class="n">timeAll</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">harmPhase</span> <span class="o">==</span> <span class="s">&quot;Random&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lowHarm</span><span class="p">,</span> <span class="n">highHarm</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span>
            <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
                <span class="n">tone</span> <span class="o">=</span> <span class="n">tone</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">((</span><span class="n">F0</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">stretchHz</span><span class="p">)</span> <span class="o">*</span> <span class="n">timeAll</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Left&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Right&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c">#odd harmonic</span>
                    <span class="n">toneOdd</span> <span class="o">=</span> <span class="n">toneOdd</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">((</span><span class="n">F0</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">stretchHz</span><span class="p">)</span> <span class="o">*</span> <span class="n">timeAll</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">toneEven</span> <span class="o">=</span> <span class="n">toneEven</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">((</span><span class="n">F0</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">stretchHz</span><span class="p">)</span> <span class="o">*</span> <span class="n">timeAll</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>                     <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">tone</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>        <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">tone</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">tone</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>                     <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span>  <span class="n">tone</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>        <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">tone</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">tone</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>                     <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span>  <span class="n">tone</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>        <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">tone</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">tone</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span>
        <span class="n">snd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">snd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Left&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>                     <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span>  <span class="n">toneOdd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>        <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">toneOdd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">toneOdd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>                     <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">toneEven</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>        <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">toneEven</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">toneEven</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Right&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>                     <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span>  <span class="n">toneOdd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>        <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">toneOdd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">toneOdd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>                     <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">toneEven</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>        <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">toneEven</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">toneEven</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span>
        

    <span class="k">return</span> <span class="n">snd</span>

</div>
<div class="viewcode-block" id="complexToneParallel"><a class="viewcode-back" href="../index.html#sndlib.complexToneParallel">[docs]</a><span class="k">def</span> <span class="nf">complexToneParallel</span><span class="p">(</span><span class="n">F0</span><span class="p">,</span> <span class="n">harmPhase</span><span class="p">,</span> <span class="n">lowHarm</span><span class="p">,</span> <span class="n">highHarm</span><span class="p">,</span> <span class="n">stretch</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Synthetise a complex tone.</span>

<span class="sd">    This function produces the same results of complexTone. The only difference</span>
<span class="sd">    is that it uses the multiprocessing Python module to exploit multicore</span>
<span class="sd">    processors and compute the partials in a parallel fashion. Notice that</span>
<span class="sd">    there is a substantial overhead in setting up the parallel computations.</span>
<span class="sd">    This means that for relatively short sounds (in the order of seconds),</span>
<span class="sd">    this function will actually be *slower* than complexTone.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    F0 : float</span>
<span class="sd">        Tone fundamental frequency in hertz.</span>
<span class="sd">    harmPhase : one of &#39;Sine&#39;, &#39;Cosine&#39;, &#39;Alternating&#39;, &#39;Random&#39;, &#39;Schroeder&#39;</span>
<span class="sd">        Phase relationship between the partials of the complex tone.</span>
<span class="sd">    lowHarm : int</span>
<span class="sd">        Lowest harmonic component number.</span>
<span class="sd">    highHarm : int</span>
<span class="sd">        Highest harmonic component number.</span>
<span class="sd">    stretch : float</span>
<span class="sd">        Harmonic stretch in %F0. Increase each harmonic frequency by a fixed value</span>
<span class="sd">        that is equal to (F0*stretch)/100. If &#39;stretch&#39; is different than</span>
<span class="sd">        zero, an inhanmonic complex tone will be generated.</span>
<span class="sd">    level : float</span>
<span class="sd">        The level of each partial in dB SPL.</span>
<span class="sd">    duration : float</span>
<span class="sd">        Tone duration (excluding ramps) in milliseconds.</span>
<span class="sd">    ramp : float</span>
<span class="sd">        Duration of the onset and offset ramps in milliseconds.</span>
<span class="sd">        The total duration of the sound will be duration+ramp*2.</span>
<span class="sd">    channel : &#39;Right&#39;, &#39;Left&#39;, &#39;Both&#39;, &#39;Odd Right&#39; or &#39;Odd Left&#39;</span>
<span class="sd">        Channel in which the tone will be generated. If &#39;channel&#39;</span>
<span class="sd">        if &#39;Odd Right&#39;, odd numbered harmonics will be presented</span>
<span class="sd">        to the right channel and even number harmonics to the left</span>
<span class="sd">        channel. The opposite is true if &#39;channel&#39; is &#39;Odd Left&#39;.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>
<span class="sd">    maxLevel : float</span>
<span class="sd">        Level in dB SPL output by the soundcard for a sinusoid of amplitude 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">        The array has dimensions (nSamples, 2).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; ct = complexTone(F0=440, harmPhase=&#39;Sine&#39;, lowHarm=3, highHarm=10,</span>
<span class="sd">    ...     stretch=0, level=55, duration=180, ramp=10, channel=&#39;Both&#39;,</span>
<span class="sd">    ...     fs=48000, maxLevel=100)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">amp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">level</span> <span class="o">-</span> <span class="n">maxLevel</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">durationSec</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c">#convert from ms to sec</span>
    <span class="n">rampSec</span> <span class="o">=</span> <span class="n">ramp</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="n">stretchHz</span> <span class="o">=</span> <span class="p">(</span><span class="n">F0</span><span class="o">*</span><span class="n">stretch</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span>
    
    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">durationSec</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nRamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">rampSec</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nTot</span> <span class="o">=</span> <span class="n">nSamples</span> <span class="o">+</span> <span class="p">(</span><span class="n">nRamp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">snd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">tn</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pool</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lowHarm</span><span class="p">,</span> <span class="n">highHarm</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="c">#Select channel</span>
        <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
            <span class="n">thisChan</span> <span class="o">=</span> <span class="n">channel</span>
        <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Left&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Right&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c">#odd harmonic</span>
                <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Left&quot;</span><span class="p">:</span>
                    <span class="n">thisChan</span> <span class="o">=</span> <span class="s">&quot;Left&quot;</span>
                <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Right&quot;</span><span class="p">:</span>
                    <span class="n">thisChan</span> <span class="o">=</span> <span class="s">&quot;Right&quot;</span>
            <span class="k">else</span><span class="p">:</span> <span class="c">#even harmonic</span>
                <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Left&quot;</span><span class="p">:</span>
                    <span class="n">thisChan</span> <span class="o">=</span> <span class="s">&quot;Right&quot;</span>
                <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Right&quot;</span><span class="p">:</span>
                    <span class="n">thisChan</span> <span class="o">=</span> <span class="s">&quot;Left&quot;</span>
        <span class="c">#Select phase</span>
        <span class="k">if</span> <span class="n">harmPhase</span> <span class="o">==</span> <span class="s">&quot;Sine&quot;</span><span class="p">:</span>
            <span class="n">thisPhase</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">harmPhase</span> <span class="o">==</span> <span class="s">&quot;Cosine&quot;</span><span class="p">:</span>
            <span class="n">thisPhase</span> <span class="o">=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">elif</span> <span class="n">harmPhase</span> <span class="o">==</span> <span class="s">&quot;Alternating&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c">#odd harmonic</span>
                <span class="n">thisPhase</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thisPhase</span> <span class="o">=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">elif</span> <span class="n">harmPhase</span> <span class="o">==</span> <span class="s">&quot;Schroeder&quot;</span><span class="p">:</span>
            <span class="n">thisPhase</span> <span class="o">=</span> <span class="o">-</span><span class="n">pi</span> <span class="o">*</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">highHarm</span>
        <span class="k">elif</span> <span class="n">harmPhase</span> <span class="o">==</span> <span class="s">&quot;Random&quot;</span><span class="p">:</span>
            <span class="n">thisPhase</span> <span class="o">=</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span>
                
        <span class="n">pool</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">pureTone</span><span class="p">,</span> <span class="p">(</span><span class="n">F0</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="n">stretchHz</span><span class="p">,</span> <span class="n">thisPhase</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">thisChan</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">),</span> <span class="n">callback</span><span class="o">=</span><span class="n">tn</span><span class="o">.</span><span class="n">append</span><span class="p">)</span>

    <span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tn</span><span class="p">)):</span>
        <span class="n">snd</span> <span class="o">=</span> <span class="n">snd</span> <span class="o">+</span> <span class="n">tn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        
    <span class="k">return</span> <span class="n">snd</span>
</div>
<div class="viewcode-block" id="ERBDistance"><a class="viewcode-back" href="../index.html#sndlib.ERBDistance">[docs]</a><span class="k">def</span> <span class="nf">ERBDistance</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">deltaERB</span> <span class="o">=</span> <span class="mf">21.4</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="mf">0.00437</span><span class="o">*</span><span class="n">f2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mf">21.4</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="mf">0.00437</span><span class="o">*</span><span class="n">f1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">deltaERB</span>
</div>
<div class="viewcode-block" id="expAMNoise"><a class="viewcode-back" href="../index.html#sndlib.expAMNoise">[docs]</a><span class="k">def</span> <span class="nf">expAMNoise</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span> <span class="n">fm</span><span class="p">,</span> <span class="n">deltaCents</span><span class="p">,</span> <span class="n">fmPhase</span><span class="p">,</span> <span class="n">AMDepth</span><span class="p">,</span> <span class="n">spectrumLevel</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a sinusoidally amplitude-modulated noise with an exponentially</span>
<span class="sd">    modulated AM frequency.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fc : float</span>
<span class="sd">        Carrier AM frequency in hertz. </span>
<span class="sd">    fm : float</span>
<span class="sd">        Modulation of the AM frequency in Hz.</span>
<span class="sd">    deltaCents : float</span>
<span class="sd">        AM frequency excursion in cents. The instataneous AM frequency of the noise</span>
<span class="sd">         will vary from fc**(-deltaCents/1200) to fc**(+deltaCents/1200).</span>
<span class="sd">    fmPhase : float</span>
<span class="sd">        Starting phase of the AM modulation in radians.</span>
<span class="sd">    AMDepth : float</span>
<span class="sd">        Amplitude modulation depth.</span>
<span class="sd">    spectrumLevel : float</span>
<span class="sd">        Noise spectrum level in dB SPL. </span>
<span class="sd">    duration : float</span>
<span class="sd">        Tone duration (excluding ramps) in milliseconds.</span>
<span class="sd">    ramp : float</span>
<span class="sd">        Duration of the onset and offset ramps in milliseconds.</span>
<span class="sd">        The total duration of the sound will be duration+ramp*2.</span>
<span class="sd">    channel : &#39;Right&#39;, &#39;Left&#39; or &#39;Both&#39;</span>
<span class="sd">        Channel in which the tone will be generated.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>
<span class="sd">    maxLevel : float</span>
<span class="sd">        Level in dB SPL output by the soundcard for a sinusoid of</span>
<span class="sd">        amplitude 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; snd = expAMNoise(fc=150, fm=2.4, deltaCents=1200, fmPhase=3.14, AMDepth = 1,</span>
<span class="sd">    ...     spectrumLevel=24, duration=380, ramp=10, channel=&#39;Both&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">amp</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">fs</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">spectrumLevel</span> <span class="o">-</span> <span class="n">maxLevel</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">))</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c">#convert from ms to sec</span>
    <span class="n">ramp</span> <span class="o">=</span> <span class="n">ramp</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nRamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ramp</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nTot</span> <span class="o">=</span> <span class="n">nSamples</span> <span class="o">+</span> <span class="p">(</span><span class="n">nRamp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">timeAll</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nTot</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>
    <span class="n">timeRamp</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nRamp</span><span class="p">)</span> 

    <span class="n">snd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="c">#random is a numpy module</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">nTot</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">nTot</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">nTot</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">nTot</span><span class="p">))</span>
    <span class="n">RMS</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">noise</span><span class="o">*</span><span class="n">noise</span><span class="p">))</span>
    <span class="c">#scale the noise so that the maxAmplitude goes from -1 to 1</span>
    <span class="c">#since A = RMS*sqrt(2)</span>
    <span class="n">scaled_noise</span> <span class="o">=</span> <span class="n">noise</span> <span class="o">/</span> <span class="p">(</span><span class="n">RMS</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

    <span class="c">#(1 + AMDepth*sin(2*pi*AMFreq*timeAll[0:nRamp]))</span>

    <span class="n">fArr</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fc</span><span class="o">*</span><span class="mi">2</span><span class="o">**</span><span class="p">((</span><span class="n">deltaCents</span><span class="o">/</span><span class="mi">1200</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fm</span><span class="o">*</span><span class="n">timeAll</span><span class="o">+</span><span class="n">fmPhase</span><span class="p">))</span>
    <span class="n">ang</span> <span class="o">=</span> <span class="p">(</span><span class="n">cumsum</span><span class="p">(</span><span class="n">fArr</span><span class="p">)</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span> <span class="c">#+ startPhase</span>
    <span class="c">#amp* sin(ang[nRamp:nRamp+nSamples])</span>
    <span class="c">#* (1 + AMDepth*sin(ang[0:nRamp]))</span>
    <span class="c">#* (1 + AMDepth*sin(ang[nRamp:nRamp+nSamples]))</span>
    <span class="c">#* (1 + AMDepth*sin(ang[nRamp+nSamples:len(timeAll)]))</span>
    <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">AMDepth</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">AMDepth</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]))</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">AMDepth</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">AMDepth</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">AMDepth</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]))</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">AMDepth</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">AMDepth</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">AMDepth</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]))</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">AMDepth</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span>

        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">AMDepth</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">AMDepth</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]))</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">AMDepth</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]))</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">scaled_noise</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">snd</span>


    <span class="k">return</span> <span class="n">snd</span>
</div>
<div class="viewcode-block" id="expSinFMComplex"><a class="viewcode-back" href="../index.html#sndlib.expSinFMComplex">[docs]</a><span class="k">def</span> <span class="nf">expSinFMComplex</span><span class="p">(</span><span class="n">F0</span><span class="p">,</span> <span class="n">lowHarm</span><span class="p">,</span> <span class="n">highHarm</span><span class="p">,</span> <span class="n">harmPhase</span><span class="p">,</span> <span class="n">fm</span><span class="p">,</span> <span class="n">deltaCents</span><span class="p">,</span> <span class="n">fmPhase</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a frequency-modulated complex tone with an exponential sinusoid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fc : float</span>
<span class="sd">        Carrier frequency in hertz. </span>
<span class="sd">    fm : float</span>
<span class="sd">        Modulation frequency in Hz.</span>
<span class="sd">    deltaCents : float</span>
<span class="sd">        Frequency excursion in cents. The instataneous frequency of the tone</span>
<span class="sd">         will vary from fc**(-deltaCents/1200) to fc**(+deltaCents/1200).</span>
<span class="sd">    fmPhase : float</span>
<span class="sd">        Starting fmPhase in radians.</span>
<span class="sd">    level : float</span>
<span class="sd">        Tone level in dB SPL. </span>
<span class="sd">    duration : float</span>
<span class="sd">        Tone duration (excluding ramps) in milliseconds.</span>
<span class="sd">    ramp : float</span>
<span class="sd">        Duration of the onset and offset ramps in milliseconds.</span>
<span class="sd">        The total duration of the sound will be duration+ramp*2.</span>
<span class="sd">    channel : &#39;Right&#39;, &#39;Left&#39; or &#39;Both&#39;</span>
<span class="sd">        Channel in which the tone will be generated.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>
<span class="sd">    maxLevel : float</span>
<span class="sd">        Level in dB SPL output by the soundcard for a sinusoid of</span>
<span class="sd">        amplitude 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; snd = expSinFMTone(fc=1000, fm=40, deltaCents=1200, fmPhase=0, level=55, </span>
<span class="sd">    ...     duration=180, ramp=10, channel=&#39;Both&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lowHarm</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">highHarm</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">harmPhase</span> <span class="o">==</span> <span class="s">&quot;Sine&quot;</span><span class="p">:</span>
            <span class="n">startPhase</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">harmPhase</span> <span class="o">==</span> <span class="s">&quot;Cosine&quot;</span><span class="p">:</span>
            <span class="n">startPhase</span> <span class="o">=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">elif</span> <span class="n">harmPhase</span> <span class="o">==</span> <span class="s">&quot;Alternating&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c">#odd harmonic</span>
                <span class="n">startPhase</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">startPhase</span> <span class="o">=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">lowHarm</span><span class="p">:</span>
            <span class="n">snd</span> <span class="o">=</span> <span class="n">expSinFMTone</span><span class="p">(</span><span class="n">F0</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">fm</span><span class="p">,</span> <span class="n">deltaCents</span><span class="p">,</span> <span class="n">fmPhase</span><span class="p">,</span> <span class="n">startPhase</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">snd</span> <span class="o">=</span> <span class="n">snd</span> <span class="o">+</span> <span class="n">expSinFMTone</span><span class="p">(</span><span class="n">F0</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">fm</span><span class="p">,</span> <span class="n">deltaCents</span><span class="p">,</span> <span class="n">fmPhase</span><span class="p">,</span> <span class="n">startPhase</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">snd</span>

</div>
<div class="viewcode-block" id="expSinFMTone"><a class="viewcode-back" href="../index.html#sndlib.expSinFMTone">[docs]</a><span class="k">def</span> <span class="nf">expSinFMTone</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span> <span class="n">fm</span><span class="p">,</span> <span class="n">deltaCents</span><span class="p">,</span> <span class="n">fmPhase</span><span class="p">,</span> <span class="n">startPhase</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a frequency-modulated tone with an exponential sinusoid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fc : float</span>
<span class="sd">        Carrier frequency in hertz. </span>
<span class="sd">    fm : float</span>
<span class="sd">        Modulation frequency in Hz.</span>
<span class="sd">    deltaCents : float</span>
<span class="sd">        Frequency excursion in cents. The instataneous frequency of the tone</span>
<span class="sd">         will vary from fc**(-deltaCents/1200) to fc**(+deltaCents/1200).</span>
<span class="sd">    fmPhase : float</span>
<span class="sd">        Starting fmPhase in radians.</span>
<span class="sd">    level : float</span>
<span class="sd">        Tone level in dB SPL. </span>
<span class="sd">    duration : float</span>
<span class="sd">        Tone duration (excluding ramps) in milliseconds.</span>
<span class="sd">    ramp : float</span>
<span class="sd">        Duration of the onset and offset ramps in milliseconds.</span>
<span class="sd">        The total duration of the sound will be duration+ramp*2.</span>
<span class="sd">    channel : &#39;Right&#39;, &#39;Left&#39; or &#39;Both&#39;</span>
<span class="sd">        Channel in which the tone will be generated.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>
<span class="sd">    maxLevel : float</span>
<span class="sd">        Level in dB SPL output by the soundcard for a sinusoid of</span>
<span class="sd">        amplitude 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; snd = expSinFMTone(fc=1000, fm=40, deltaCents=1200, fmPhase=0, level=55, </span>
<span class="sd">    ...     duration=180, ramp=10, channel=&#39;Both&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
  
    <span class="n">amp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">level</span> <span class="o">-</span> <span class="n">maxLevel</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c">#convert from ms to sec</span>
    <span class="n">ramp</span> <span class="o">=</span> <span class="n">ramp</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nRamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ramp</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nTot</span> <span class="o">=</span> <span class="n">nSamples</span> <span class="o">+</span> <span class="p">(</span><span class="n">nRamp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">timeAll</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nTot</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>
    <span class="n">timeRamp</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nRamp</span><span class="p">)</span>
    <span class="n">fArr</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fc</span><span class="o">*</span><span class="mi">2</span><span class="o">**</span><span class="p">((</span><span class="n">deltaCents</span><span class="o">/</span><span class="mi">1200</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fm</span><span class="o">*</span><span class="n">timeAll</span><span class="o">+</span><span class="n">fmPhase</span><span class="p">))</span>
    <span class="n">ang</span> <span class="o">=</span> <span class="p">(</span><span class="n">cumsum</span><span class="p">(</span><span class="n">fArr</span><span class="p">)</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span> <span class="o">+</span> <span class="n">startPhase</span>

    <span class="n">snd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">])</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">])</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)])</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">])</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">])</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)])</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">])</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">])</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)])</span>
        <span class="n">snd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">snd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
       

    <span class="k">return</span> <span class="n">snd</span>


</div>
<div class="viewcode-block" id="camSinFMComplex"><a class="viewcode-back" href="../index.html#sndlib.camSinFMComplex">[docs]</a><span class="k">def</span> <span class="nf">camSinFMComplex</span><span class="p">(</span><span class="n">F0</span><span class="p">,</span> <span class="n">lowHarm</span><span class="p">,</span> <span class="n">highHarm</span><span class="p">,</span> <span class="n">harmPhase</span><span class="p">,</span> <span class="n">fm</span><span class="p">,</span> <span class="n">deltaCams</span><span class="p">,</span> <span class="n">fmPhase</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a tone frequency modulated with an exponential sinusoid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fc : float</span>
<span class="sd">        Carrier frequency in hertz. </span>
<span class="sd">    fm : float</span>
<span class="sd">        Modulation frequency in Hz.</span>
<span class="sd">    deltaCams : float</span>
<span class="sd">        Frequency excursion in cam units (ERBn number scale). </span>
<span class="sd">    fmPhase : float</span>
<span class="sd">        Starting fmPhase in radians.</span>
<span class="sd">    level : float</span>
<span class="sd">        Tone level in dB SPL. </span>
<span class="sd">    duration : float</span>
<span class="sd">        Tone duration (excluding ramps) in milliseconds.</span>
<span class="sd">    ramp : float</span>
<span class="sd">        Duration of the onset and offset ramps in milliseconds.</span>
<span class="sd">        The total duration of the sound will be duration+ramp*2.</span>
<span class="sd">    channel : &#39;Right&#39;, &#39;Left&#39; or &#39;Both&#39;</span>
<span class="sd">        Channel in which the tone will be generated.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>
<span class="sd">    maxLevel : float</span>
<span class="sd">        Level in dB SPL output by the soundcard for a sinusoid of</span>
<span class="sd">        amplitude 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; snd = expSinFMTone(fc=1000, fm=40, deltaCents=1200, fmPhase=0, level=55, </span>
<span class="sd">    ...     duration=180, ramp=10, channel=&#39;Both&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lowHarm</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">highHarm</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">harmPhase</span> <span class="o">==</span> <span class="s">&quot;Sine&quot;</span><span class="p">:</span>
            <span class="n">startPhase</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">harmPhase</span> <span class="o">==</span> <span class="s">&quot;Cosine&quot;</span><span class="p">:</span>
            <span class="n">startPhase</span> <span class="o">=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">elif</span> <span class="n">harmPhase</span> <span class="o">==</span> <span class="s">&quot;Alternating&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c">#odd harmonic</span>
                <span class="n">startPhase</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">startPhase</span> <span class="o">=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">lowHarm</span><span class="p">:</span>
            <span class="n">snd</span> <span class="o">=</span> <span class="n">camSinFMTone</span><span class="p">(</span><span class="n">F0</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">fm</span><span class="p">,</span> <span class="n">deltaCams</span><span class="p">,</span> <span class="n">fmPhase</span><span class="p">,</span> <span class="n">startPhase</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">snd</span> <span class="o">=</span> <span class="n">snd</span> <span class="o">+</span> <span class="n">camSinFMTone</span><span class="p">(</span><span class="n">F0</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">fm</span><span class="p">,</span> <span class="n">deltaCams</span><span class="p">,</span> <span class="n">fmPhase</span><span class="p">,</span> <span class="n">startPhase</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">snd</span>

</div>
<div class="viewcode-block" id="camSinFMTone"><a class="viewcode-back" href="../index.html#sndlib.camSinFMTone">[docs]</a><span class="k">def</span> <span class="nf">camSinFMTone</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span> <span class="n">fm</span><span class="p">,</span> <span class="n">deltaCams</span><span class="p">,</span> <span class="n">fmPhase</span><span class="p">,</span> <span class="n">startPhase</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a tone frequency modulated with an exponential sinusoid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fc : float</span>
<span class="sd">        Carrier frequency in hertz. </span>
<span class="sd">    fm : float</span>
<span class="sd">        Modulation frequency in Hz.</span>
<span class="sd">    deltaCams : float</span>
<span class="sd">        Frequency excursion in cam units (ERBn number scale). </span>
<span class="sd">    fmPhase : float</span>
<span class="sd">        Starting fmPhase in radians.</span>
<span class="sd">    level : float</span>
<span class="sd">        Tone level in dB SPL. </span>
<span class="sd">    duration : float</span>
<span class="sd">        Tone duration (excluding ramps) in milliseconds.</span>
<span class="sd">    ramp : float</span>
<span class="sd">        Duration of the onset and offset ramps in milliseconds.</span>
<span class="sd">        The total duration of the sound will be duration+ramp*2.</span>
<span class="sd">    channel : &#39;Right&#39;, &#39;Left&#39; or &#39;Both&#39;</span>
<span class="sd">        Channel in which the tone will be generated.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>
<span class="sd">    maxLevel : float</span>
<span class="sd">        Level in dB SPL output by the soundcard for a sinusoid of</span>
<span class="sd">        amplitude 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; snd = expSinFMTone(fc=1000, fm=40, deltaCents=1200, fmPhase=0, level=55, </span>
<span class="sd">    ...     duration=180, ramp=10, channel=&#39;Both&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
  
    <span class="n">amp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">level</span> <span class="o">-</span> <span class="n">maxLevel</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c">#convert from ms to sec</span>
    <span class="n">ramp</span> <span class="o">=</span> <span class="n">ramp</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nRamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ramp</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nTot</span> <span class="o">=</span> <span class="n">nSamples</span> <span class="o">+</span> <span class="p">(</span><span class="n">nRamp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">timeAll</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nTot</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>
    <span class="n">timeRamp</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nRamp</span><span class="p">)</span>
    <span class="c">#fArr = 2*pi*fc*2**((deltaCents/1200)*cos(2*pi*fm*timeAll+fmPhase))</span>
    <span class="n">fArr</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">freqFromERBInterval</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span> <span class="n">deltaCams</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fm</span><span class="o">*</span><span class="n">timeAll</span><span class="o">+</span><span class="n">fmPhase</span><span class="p">))</span> 
    <span class="n">ang</span> <span class="o">=</span> <span class="p">(</span><span class="n">cumsum</span><span class="p">(</span><span class="n">fArr</span><span class="p">)</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span> <span class="o">+</span> <span class="n">startPhase</span>

    <span class="n">snd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">])</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">])</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)])</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">])</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">])</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)])</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">])</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">])</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)])</span>
        <span class="n">snd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">snd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
       

    <span class="k">return</span> <span class="n">snd</span>



</div>
<div class="viewcode-block" id="FMTone"><a class="viewcode-back" href="../index.html#sndlib.FMTone">[docs]</a><span class="k">def</span> <span class="nf">FMTone</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span> <span class="n">fm</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a frequency modulated tone.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fc : float</span>
<span class="sd">        Carrier frequency in hertz. This is the frequency of the tone at fm zero crossing.</span>
<span class="sd">    fm : float</span>
<span class="sd">        Modulation frequency in Hz.</span>
<span class="sd">    mi : float</span>
<span class="sd">        Modulation index, also called beta and is equal to deltaF/fm, where</span>
<span class="sd">        deltaF is the maximum deviation of the instantaneous frequency from</span>
<span class="sd">        the carrier frequency.</span>
<span class="sd">    phase : float</span>
<span class="sd">        Starting phase in radians.</span>
<span class="sd">    level : float</span>
<span class="sd">        Tone level in dB SPL. </span>
<span class="sd">    duration : float</span>
<span class="sd">        Tone duration (excluding ramps) in milliseconds.</span>
<span class="sd">    ramp : float</span>
<span class="sd">        Duration of the onset and offset ramps in milliseconds.</span>
<span class="sd">        The total duration of the sound will be duration+ramp*2.</span>
<span class="sd">    channel : &#39;Right&#39;, &#39;Left&#39; or &#39;Both&#39;</span>
<span class="sd">        Channel in which the tone will be generated.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>
<span class="sd">    maxLevel : float</span>
<span class="sd">        Level in dB SPL output by the soundcard for a sinusoid of</span>
<span class="sd">        amplitude 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; snd = FMTone(fc=1000, fm=40, mi=1, phase=0, level=55, duration=180,</span>
<span class="sd">    ...     ramp=10, channel=&#39;Both&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
  
    <span class="n">amp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">level</span> <span class="o">-</span> <span class="n">maxLevel</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c">#convert from ms to sec</span>
    <span class="n">ramp</span> <span class="o">=</span> <span class="n">ramp</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nRamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ramp</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nTot</span> <span class="o">=</span> <span class="n">nSamples</span> <span class="o">+</span> <span class="p">(</span><span class="n">nRamp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">timeAll</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nTot</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>
    <span class="n">timeRamp</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nRamp</span><span class="p">)</span> 

    <span class="n">snd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fctimeAll</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span> <span class="o">+</span> <span class="n">mi</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fm</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">))</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fc</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span> <span class="o">+</span><span class="n">mi</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fm</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">))</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fc</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span><span class="o">+</span><span class="n">mi</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fm</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fctimeAll</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span> <span class="o">+</span> <span class="n">mi</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fm</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">))</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fc</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span> <span class="o">+</span><span class="n">mi</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fm</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">))</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fc</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span><span class="o">+</span><span class="n">mi</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fm</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fctimeAll</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span> <span class="o">+</span> <span class="n">mi</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fm</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">))</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fc</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span> <span class="o">+</span><span class="n">mi</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fm</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">))</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fc</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span><span class="o">+</span><span class="n">mi</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fm</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">))</span>
        <span class="n">snd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">snd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
       

    <span class="k">return</span> <span class="n">snd</span>

</div>
<div class="viewcode-block" id="fir2Filt"><a class="viewcode-back" href="../index.html#sndlib.fir2Filt">[docs]</a><span class="k">def</span> <span class="nf">fir2Filt</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">,</span> <span class="n">f4</span><span class="p">,</span> <span class="n">snd</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filter signal with a fir2 filter.</span>

<span class="sd">    This function designs and applies a fir2 filter to a sound.</span>
<span class="sd">    The frequency response of the ideal filter will transition</span>
<span class="sd">    from 0 to 1 between &#39;f1&#39; and &#39;f2&#39;, and from 1 to zero</span>
<span class="sd">    between &#39;f3&#39; and &#39;f4&#39;. The frequencies must be given in</span>
<span class="sd">    increasing order.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    f1 : float</span>
<span class="sd">        Frequency in hertz of the point at which the transition</span>
<span class="sd">        for the low-frequency cutoff ends. </span>
<span class="sd">    f2 : float</span>
<span class="sd">        Frequency in hertz of the point at which the transition</span>
<span class="sd">        for the low-frequency cutoff starts.</span>
<span class="sd">    f3 : float</span>
<span class="sd">        Frequency in hertz of the point at which the transition</span>
<span class="sd">        for the high-frequency cutoff starts.</span>
<span class="sd">    f4 : float</span>
<span class="sd">        Frequency in hertz of the point at which the transition</span>
<span class="sd">        for the high-frequency cutoff ends. </span>
<span class="sd">    snd : array of floats</span>
<span class="sd">        The sound to be filtered.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Sampling frequency of &#39;snd&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>

<span class="sd">    Notes</span>
<span class="sd">    -------</span>
<span class="sd">    If &#39;f1&#39; and &#39;f2&#39; are zero the filter will be lowpass.</span>
<span class="sd">    If &#39;f3&#39; and &#39;f4&#39; are equal to or greater than the nyquist</span>
<span class="sd">    frequency (fs/2) the filter will be highpass.</span>
<span class="sd">    In the other cases the filter will be bandpass.</span>

<span class="sd">    The order of the filter (number of taps) is fixed at 256.</span>
<span class="sd">    This function uses internally &#39;scipy.signal.firwin2&#39;.</span>
<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; noise = broadbandNoise(spectrumLevel=40, duration=180, ramp=10,</span>
<span class="sd">    ...     channel=&#39;Both&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">    &gt;&gt;&gt; lpNoise = fir2Filt(f1=0, f2=0, f3=1000, f4=1200, </span>
<span class="sd">    ...     snd=noise, fs=48000) #lowpass filter</span>
<span class="sd">    &gt;&gt;&gt; hpNoise = fir2Filt(f1=0, f2=0, f3=24000, f4=26000, </span>
<span class="sd">    ...     snd=noise, fs=48000) #highpass filter</span>
<span class="sd">    &gt;&gt;&gt; bpNoise = fir2Filt(f1=400, f2=600, f3=4000, f4=4400, </span>
<span class="sd">    ...     snd=noise, fs=48000) #bandpass filter</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">f1</span> <span class="o">=</span> <span class="p">(</span><span class="n">f1</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>
    <span class="n">f2</span> <span class="o">=</span> <span class="p">(</span><span class="n">f2</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>
    <span class="n">f3</span> <span class="o">=</span> <span class="p">(</span><span class="n">f3</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>
    <span class="n">f4</span> <span class="o">=</span> <span class="p">(</span><span class="n">f4</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>

    <span class="n">n</span> <span class="o">=</span> <span class="mi">256</span>

    <span class="k">if</span> <span class="n">f2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c">#low pass</span>
        <span class="c">#print(&#39;lowpass&#39;)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">f3</span><span class="p">,</span> <span class="n">f4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.00003</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        
    <span class="k">elif</span> <span class="n">f3</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span> <span class="c">#bandpass</span>
        <span class="c">#print(&#39;bandpass&#39;)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="p">((</span><span class="n">f2</span><span class="o">+</span><span class="n">f3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">f3</span><span class="p">,</span> <span class="n">f4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.00003</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.00003</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="c">#print(&#39;highpass&#39;)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="mf">0.999999</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="c">#high pass</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.00003</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        
        
    <span class="n">b</span> <span class="o">=</span> <span class="n">firwin2</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">m</span><span class="p">);</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">snd</span><span class="p">)</span>
    <span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">snd</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">snd</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">x</span>
</div>
<div class="viewcode-block" id="freqFromERBInterval"><a class="viewcode-back" href="../index.html#sndlib.freqFromERBInterval">[docs]</a><span class="k">def</span> <span class="nf">freqFromERBInterval</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">deltaERB</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">deltaERB</span> <span class="o">+</span> <span class="mf">21.4</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="mf">0.00437</span><span class="o">*</span><span class="n">f1</span> <span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mf">21.4</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.00437</span> 

    <span class="k">return</span> <span class="n">f2</span>
    
</div>
<div class="viewcode-block" id="getRms"><a class="viewcode-back" href="../index.html#sndlib.getRms">[docs]</a><span class="k">def</span> <span class="nf">getRms</span><span class="p">(</span><span class="n">sig</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the root mean square (RMS) value of the signal.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sig : array of floats</span>
<span class="sd">        The signal for which the RMS needs to be computed.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rms : float</span>
<span class="sd">       The RMS of &#39;sig&#39;.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; pt = pureTone(frequency=440, phase=0, level=65, duration=180,</span>
<span class="sd">    ...     ramp=10, channel=&#39;Right&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">    &gt;&gt;&gt; getRms(pt)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rms</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">sig</span><span class="o">*</span><span class="n">sig</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">rms</span>
</div>
<div class="viewcode-block" id="gate"><a class="viewcode-back" href="../index.html#sndlib.gate">[docs]</a><span class="k">def</span> <span class="nf">gate</span><span class="p">(</span><span class="n">ramps</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Impose onset and offset ramps to a sound.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ramps : float</span>
<span class="sd">        The duration of the ramps.</span>
<span class="sd">    sig : array of floats    </span>
<span class="sd">        The signal on which the ramps should be imposed.</span>
<span class="sd">    fs : int</span>
<span class="sd">        The sampling frequency os &#39;sig&#39;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sig : array of floats</span>
<span class="sd">       The ramped signal.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; noise = broadbandNoise(spectrumLevel=40, duration=200, ramp=0,</span>
<span class="sd">    ...     channel=&#39;Both&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">    &gt;&gt;&gt; gate(ramps=10, sig=noise, fs=48000)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ramps</span> <span class="o">=</span> <span class="n">ramps</span> <span class="o">/</span> <span class="mf">1000.</span>
    <span class="n">nRamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ramps</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">timeRamp</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">nRamp</span><span class="p">)</span>
    <span class="n">nTot</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">nStartSecondRamp</span> <span class="o">=</span> <span class="n">nTot</span> <span class="o">-</span> <span class="n">nRamp</span>
    
    <span class="n">sig</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sig</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span>  <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">sig</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sig</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span>  <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">sig</span><span class="p">[</span><span class="n">nStartSecondRamp</span><span class="p">:</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sig</span><span class="p">[</span><span class="n">nStartSecondRamp</span><span class="p">:</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">sig</span><span class="p">[</span><span class="n">nStartSecondRamp</span><span class="p">:</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sig</span><span class="p">[</span><span class="n">nStartSecondRamp</span><span class="p">:</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sig</span>

</div>
<div class="viewcode-block" id="glide"><a class="viewcode-back" href="../index.html#sndlib.glide">[docs]</a><span class="k">def</span> <span class="nf">glide</span><span class="p">(</span><span class="n">freqStart</span><span class="p">,</span> <span class="n">ftype</span><span class="p">,</span> <span class="n">excursion</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Synthetize a rising or falling tone glide with frequency changing</span>
<span class="sd">    linearly or exponentially. </span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    freqStart : float</span>
<span class="sd">        Starting frequency in hertz.</span>
<span class="sd">    ftype : string</span>
<span class="sd">        If &#39;linear&#39;, the frequency will change linearly on a Hz scale.</span>
<span class="sd">        If &#39;exponential&#39;, the frequency will change exponentially on a cents scale.</span>
<span class="sd">    excursion : float</span>
<span class="sd">        If ftype is &#39;linear&#39;, excursion is the total frequency change in Hz.</span>
<span class="sd">        The final frequency will be freqStart + excursion.</span>
<span class="sd">        If ftype is &#39;exponential&#39;, excursion is the total frequency change in cents.</span>
<span class="sd">        The final frequency in Hz will be freqStart*2**(excusrion/1200).</span>
<span class="sd">    level : float</span>
<span class="sd">        Level of the tone in dB SPL.</span>
<span class="sd">    duration : float</span>
<span class="sd">        Tone duration (excluding ramps) in milliseconds.</span>
<span class="sd">    ramp : float</span>
<span class="sd">        Duration of the onset and offset ramps in milliseconds.</span>
<span class="sd">        The total duration of the sound will be duration+ramp*2.</span>
<span class="sd">    channel : string (&#39;Right&#39;, &#39;Left&#39; or &#39;Both&#39;)</span>
<span class="sd">        Channel in which the tone will be generated.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>
<span class="sd">    maxLevel : float</span>
<span class="sd">        Level in dB SPL output by the soundcard for a sinusoid of amplitude 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">        The array has dimensions (nSamples, 2).</span>
<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; gl = glide(freqStart=440, type=&#39;exponential&#39;, excursion=500,</span>
<span class="sd">            level=55, duration=180, phase=0, ramp=10, channel=&#39;Both&#39;,</span>
<span class="sd">            fs=48000, maxLevel=100)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">totDur</span> <span class="o">=</span> <span class="n">duration</span><span class="o">/</span><span class="mi">1000</span><span class="o">+</span><span class="n">ramp</span><span class="o">/</span><span class="mi">1000</span><span class="o">*</span><span class="mi">2</span>
    <span class="n">rate</span> <span class="o">=</span> <span class="n">excursion</span> <span class="o">/</span> <span class="n">totDur</span>
    <span class="n">snd</span> <span class="o">=</span> <span class="n">chirp</span><span class="p">(</span><span class="n">freqStart</span><span class="p">,</span> <span class="n">ftype</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">snd</span>
</div>
<div class="viewcode-block" id="harmComplFromNarrowbandNoise"><a class="viewcode-back" href="../index.html#sndlib.harmComplFromNarrowbandNoise">[docs]</a><span class="k">def</span> <span class="nf">harmComplFromNarrowbandNoise</span><span class="p">(</span><span class="n">F0</span><span class="p">,</span> <span class="n">lowHarm</span><span class="p">,</span> <span class="n">highHarm</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate an harmonic complex tone from narrow noise bands.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    F0 : float</span>
<span class="sd">        Fundamental frequency of the complex.</span>
<span class="sd">    lowHarm : int</span>
<span class="sd">        Lowest harmonic component number. The first component is #1.</span>
<span class="sd">    highHarm : int</span>
<span class="sd">        Highest harmonic component number.</span>
<span class="sd">    level : float</span>
<span class="sd">        The spectrum level of the noise bands in dB SPL.</span>
<span class="sd">    bandwidth : float</span>
<span class="sd">        The width of each noise band in hertz.</span>
<span class="sd">    duration : float</span>
<span class="sd">        Tone duration (excluding ramps) in milliseconds.</span>
<span class="sd">    ramp : float</span>
<span class="sd">        Duration of the onset and offset ramps in milliseconds.</span>
<span class="sd">        The total duration of the sound will be duration+ramp*2.</span>
<span class="sd">    channel : &#39;Right&#39;, &#39;Left&#39;, &#39;Both&#39;, &#39;Odd Right&#39; or &#39;Odd Left&#39;</span>
<span class="sd">        Channel in which the tone will be generated. If &#39;channel&#39;</span>
<span class="sd">        if &#39;Odd Right&#39;, odd numbered harmonics will be presented</span>
<span class="sd">        to the right channel and even number harmonics to the left</span>
<span class="sd">        channel. The opposite is true if &#39;channel&#39; is &#39;Odd Left&#39;.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>
<span class="sd">    maxLevel : float</span>
<span class="sd">        Level in dB SPL output by the soundcard for a sinusoid of amplitude 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : array of floats</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; c1 = harmComplFromNarrowbandNoise(F0=440, lowHarm=3, highHarm=8,</span>
<span class="sd">         level=40, bandwidth=80, duration=180, ramp=10, channel=&#39;Both&#39;,</span>
<span class="sd">         fs=48000, maxLevel=100)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">sDuration</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c">#convert from ms to sec</span>
    <span class="n">sRamp</span> <span class="o">=</span> <span class="n">ramp</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="n">totDur</span> <span class="o">=</span> <span class="n">sDuration</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sRamp</span><span class="p">)</span>
    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sDuration</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nRamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sRamp</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nTot</span> <span class="o">=</span> <span class="n">nSamples</span> <span class="o">+</span> <span class="p">(</span><span class="n">nRamp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">snd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
        <span class="n">tone</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Left&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Right&quot;</span><span class="p">:</span>
        <span class="n">toneOdd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">toneEven</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lowHarm</span><span class="p">,</span> <span class="n">highHarm</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
            <span class="n">tone</span> <span class="o">=</span>  <span class="n">tone</span> <span class="o">+</span> <span class="n">steepNoise</span><span class="p">((</span><span class="n">i</span><span class="o">*</span><span class="n">F0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">bandwidth</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">F0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">bandwidth</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Left&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Right&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c">#odd harmonic</span>
                        <span class="c">#make the tone in the left channel, then move it where needed</span>
                <span class="n">toneOdd</span> <span class="o">=</span> <span class="n">toneOdd</span> <span class="o">+</span> <span class="n">steepNoise</span><span class="p">((</span><span class="n">i</span><span class="o">*</span><span class="n">F0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">bandwidth</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">F0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">bandwidth</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="s">&quot;Left&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">toneEven</span> <span class="o">=</span> <span class="n">toneEven</span> <span class="o">+</span> <span class="n">steepNoise</span><span class="p">((</span><span class="n">i</span><span class="o">*</span><span class="n">F0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">bandwidth</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">F0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">bandwidth</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="s">&quot;Left&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">)</span>
  

    <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span> <span class="ow">or</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
        <span class="n">snd</span> <span class="o">=</span> <span class="n">tone</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Left&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">toneOdd</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">toneEven</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Odd Right&quot;</span><span class="p">:</span>
     <span class="n">snd</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">toneOdd</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
     <span class="n">snd</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">toneEven</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">snd</span>

</div>
<div class="viewcode-block" id="intNCyclesFreq"><a class="viewcode-back" href="../index.html#sndlib.intNCyclesFreq">[docs]</a><span class="k">def</span> <span class="nf">intNCyclesFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">duration</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the frequency closest to &#39;freq&#39; that has an integer number</span>
<span class="sd">    of cycles for the given sound duration.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    frequency : float</span>
<span class="sd">        Frequency in hertz.</span>
<span class="sd">    duration : float</span>
<span class="sd">        Duration of the sound, in milliseconds.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    adjFreq : float</span>
<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; intNCyclesFreq(freq=2.1, duration=1000)</span>
<span class="sd">    2.0</span>
<span class="sd">    &gt;&gt;&gt; intNCyclesFreq(freq=2, duration=1000)</span>
<span class="sd">    2.0</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c">#convert from ms to sec</span>
    <span class="n">adjFreq</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">freq</span><span class="o">*</span><span class="n">duration</span><span class="p">)</span><span class="o">/</span><span class="n">duration</span>
    <span class="k">return</span> <span class="n">adjFreq</span>
</div>
<div class="viewcode-block" id="imposeLevelGlide"><a class="viewcode-back" href="../index.html#sndlib.imposeLevelGlide">[docs]</a><span class="k">def</span> <span class="nf">imposeLevelGlide</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">deltaL</span><span class="p">,</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">endTime</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Impose a glide in level to a sound.</span>
<span class="sd">    </span>
<span class="sd">    This function changes the level of a sound with a smooth transition (an amplitude</span>
<span class="sd">    ramp) between &#39;startTime&#39; and &#39;endTime&#39;. If the signal input to the function</span>
<span class="sd">    has a level L, the signal output by the function will have a level L</span>
<span class="sd">    between time 0 and &#39;startTime&#39;, and a level L+deltaL between endTime and</span>
<span class="sd">    the end of the sound.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sig : float</span>
<span class="sd">        Sound on which to impose the level change.</span>
<span class="sd">    deltaL : float</span>
<span class="sd">        Magnitude of the level change in dB SPL.</span>
<span class="sd">    startTime : float</span>
<span class="sd">        Start of the level transition in milliseconds.</span>
<span class="sd">    endTime : float</span>
<span class="sd">        End of the level transition in milliseconds.</span>
<span class="sd">    channel : string (&#39;Right&#39;, &#39;Left&#39; or &#39;Both&#39;)</span>
<span class="sd">        Channel to which apply the level transition.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency of the sound in Hz.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : array of floats</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; pt = pureTone(frequency=440, phase=0, level=65, duration=180,</span>
<span class="sd">    ...     ramp=10, channel=&#39;Right&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">    &gt;&gt;&gt; pt2 = imposeLevelGlide(sig=pt, deltaL=10, startTime=100,</span>
<span class="sd">            endTime=120, channel=&#39;Both&#39;, fs=48000)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#here we impose an amplitude ramp rather than a linear intensity change</span>
    <span class="c">#give startTime and endTime in ms as arguments, then convert to sec</span>

    <span class="k">if</span> <span class="n">deltaL</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>

        <span class="n">startTime</span> <span class="o">=</span> <span class="n">startTime</span> <span class="o">/</span> <span class="mf">1000.</span>
        <span class="n">endTime</span>   <span class="o">=</span> <span class="n">endTime</span>   <span class="o">/</span> <span class="mf">1000.</span>

    
        <span class="n">startAmp</span> <span class="o">=</span> <span class="mi">1</span> <span class="c">#no change</span>
        <span class="n">endAmp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">deltaL</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">startPnt</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">startTime</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
        <span class="n">endPnt</span>   <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">endTime</span>   <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
        <span class="n">nRamp</span> <span class="o">=</span> <span class="n">endPnt</span> <span class="o">-</span> <span class="n">startPnt</span>
        <span class="n">timeRamp</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">nRamp</span><span class="p">)</span> 

        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">startAmp</span><span class="o">+</span><span class="n">endAmp</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">startAmp</span><span class="o">-</span><span class="n">endAmp</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">startAmp</span><span class="o">-</span><span class="n">endAmp</span><span class="p">)</span>
    
        <span class="n">ramp</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="n">y</span><span class="p">)</span>
        <span class="n">ampArray</span> <span class="o">=</span> <span class="n">ones</span><span class="p">(</span><span class="n">nSamples</span><span class="p">)</span>
        <span class="n">ampArray</span><span class="p">[</span><span class="n">startPnt</span><span class="p">:</span><span class="n">endPnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">ramp</span>
        <span class="n">ampArray</span><span class="p">[</span><span class="n">endPnt</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">ampArray</span><span class="p">)]</span> <span class="o">=</span> <span class="n">repeat</span><span class="p">(</span><span class="n">endAmp</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ampArray</span><span class="p">[</span><span class="n">endPnt</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">ampArray</span><span class="p">)]))</span>

    
        <span class="n">snd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nSamples</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span><span class="p">:</span>
            <span class="n">snd</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sig</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ampArray</span>
        <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span><span class="p">:</span>
            <span class="n">snd</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sig</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ampArray</span>
        <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
            <span class="n">snd</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sig</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ampArray</span>
            <span class="n">snd</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sig</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ampArray</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">snd</span> <span class="o">=</span> <span class="n">sig</span>

    <span class="k">return</span> <span class="n">snd</span>

</div>
<div class="viewcode-block" id="itdtoipd"><a class="viewcode-back" href="../index.html#sndlib.itdtoipd">[docs]</a><span class="k">def</span> <span class="nf">itdtoipd</span><span class="p">(</span><span class="n">itd</span><span class="p">,</span> <span class="n">freq</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert an interaural time difference to an equivalent interaural</span>
<span class="sd">    phase difference for a given frequency.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    itd : float</span>
<span class="sd">        Interaural time difference in seconds.</span>
<span class="sd">    freq : float</span>
<span class="sd">        Frequency in hertz.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ipd : float</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; itd = 300 #microseconds</span>
<span class="sd">    &gt;&gt;&gt; itd = 300/1000000 #convert to seconds</span>
<span class="sd">    &gt;&gt;&gt; itdtoipd(itd=itd, freq=1000)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">ipd</span> <span class="o">=</span> <span class="p">(</span><span class="n">itd</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">freq</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span>
    <span class="k">return</span> <span class="n">ipd</span>
</div>
<div class="viewcode-block" id="joinSndISI"><a class="viewcode-back" href="../index.html#sndlib.joinSndISI">[docs]</a><span class="k">def</span> <span class="nf">joinSndISI</span><span class="p">(</span><span class="n">sndList</span><span class="p">,</span> <span class="n">ISIList</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    Join a list of sounds with given interstimulus intervals</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sndList : list of arrays</span>
<span class="sd">        The sounds to be joined.</span>
<span class="sd">    ISIList : list of floats</span>
<span class="sd">        The interstimulus intervals between the sounds in milliseconds.</span>
<span class="sd">        This list should have one element less than the sndList.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Sampling frequency of the sounds in Hz.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : array of floats</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; pt1 = pureTone(frequency=440, phase=0, level=65, duration=180,</span>
<span class="sd">    ...       ramp=10, channel=&#39;Right&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">    &gt;&gt;&gt; pt2 = pureTone(frequency=440, phase=0, level=65, duration=180,</span>
<span class="sd">    ...       ramp=10, channel=&#39;Right&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">    &gt;&gt;&gt; tone_seq = joinSndISI([pt1, pt2], [500], 48000)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sndList</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sndList</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">thisSilence</span> <span class="o">=</span> <span class="n">makeSilence</span><span class="p">(</span><span class="n">ISIList</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thisSilence</span> <span class="o">=</span> <span class="n">makeSilence</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">snd</span> <span class="o">=</span> <span class="n">sndList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">snd</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">((</span><span class="n">snd</span><span class="p">,</span> <span class="n">thisSilence</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">snd</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">((</span><span class="n">snd</span><span class="p">,</span> <span class="n">sndList</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">snd</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">((</span><span class="n">snd</span><span class="p">,</span> <span class="n">thisSilence</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">snd</span>


</div>
<div class="viewcode-block" id="makeAsynchChord"><a class="viewcode-back" href="../index.html#sndlib.makeAsynchChord">[docs]</a><span class="k">def</span> <span class="nf">makeAsynchChord</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">phases</span><span class="p">,</span> <span class="n">tonesDuration</span><span class="p">,</span> <span class="n">tonesRamps</span><span class="p">,</span> <span class="n">tonesChannel</span><span class="p">,</span> <span class="n">SOA</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate an asynchronous chord.</span>

<span class="sd">    This function will add a set of pure tones with a given</span>
<span class="sd">    stimulus onset asynchrony (SOA). The temporal order of the</span>
<span class="sd">    successive tones is random.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    freqs : array or list of floats.</span>
<span class="sd">        Frequencies of the chord components in hertz.</span>
<span class="sd">    levels : array or list of floats.</span>
<span class="sd">        Level of each chord component in dB SPL.</span>
<span class="sd">    phases : array or list of floats.</span>
<span class="sd">        Starting phase of each chord component.</span>
<span class="sd">    tonesDuration : float</span>
<span class="sd">        Duration of the tones composing the chord in milliseconds.</span>
<span class="sd">        All tones have the same duration.</span>
<span class="sd">    tonesRamps : float</span>
<span class="sd">        Duration of the onset and offset ramps in milliseconds.</span>
<span class="sd">        The total duration of the tones will be tonesDuration+ramp*2.</span>
<span class="sd">    tonesChannel : string (&#39;Right&#39;, &#39;Left&#39; or &#39;Both&#39;)</span>
<span class="sd">        Channel in which the tones will be generated.</span>
<span class="sd">    SOA : float</span>
<span class="sd">        Onset asynchrony between the chord components.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>
<span class="sd">    maxLevel : float</span>
<span class="sd">        Level in dB SPL output by the soundcard for a sinusoid of amplitude 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; freqs = [250, 500, 1000]</span>
<span class="sd">    &gt;&gt;&gt; levels = [50, 50, 50]</span>
<span class="sd">    &gt;&gt;&gt; phases = [0, 0, 0]</span>
<span class="sd">    &gt;&gt;&gt; c1 = makeAsynchChord(freqs=freqs, levels=levels, phases=phases,</span>
<span class="sd">            tonesDuration=180, tonesRamps=10, tonesChannel=&#39;Both&#39;,</span>
<span class="sd">            SOA=60, fs=48000, maxLevel=100)</span>

<span class="sd">    &quot;&quot;&quot;</span>
     
    <span class="n">seq</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">))</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)):</span>
        <span class="n">thisFreq</span> <span class="o">=</span> <span class="n">freqs</span><span class="p">[</span><span class="n">seq</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span> <span class="n">thisLev</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[</span><span class="n">seq</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span> <span class="n">thisPhase</span> <span class="o">=</span> <span class="n">phases</span><span class="p">[</span><span class="n">seq</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="n">thisTone</span> <span class="o">=</span> <span class="n">pureTone</span><span class="p">(</span><span class="n">thisFreq</span><span class="p">,</span> <span class="n">thisPhase</span><span class="p">,</span> <span class="n">thisLev</span><span class="p">,</span> <span class="n">tonesDuration</span><span class="p">,</span> <span class="n">tonesRamps</span><span class="p">,</span> <span class="n">tonesChannel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">snd</span> <span class="o">=</span> <span class="n">thisTone</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">snd</span> <span class="o">=</span> <span class="n">addSounds</span><span class="p">(</span><span class="n">snd</span><span class="p">,</span> <span class="n">thisTone</span><span class="p">,</span> <span class="n">SOA</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">snd</span>
</div>
<div class="viewcode-block" id="makeHuggins"><a class="viewcode-back" href="../index.html#sndlib.makeHuggins">[docs]</a><span class="k">def</span> <span class="nf">makeHuggins</span><span class="p">(</span><span class="n">F0</span><span class="p">,</span> <span class="n">lowHarm</span><span class="p">,</span> <span class="n">highHarm</span><span class="p">,</span> <span class="n">spectrumLevel</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">,</span> <span class="n">phaseRelationship</span><span class="p">,</span> <span class="n">noiseType</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Synthetise a complex Huggings Pitch.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    F0 : float</span>
<span class="sd">        The centre frequency of the F0 of the complex in hertz.</span>
<span class="sd">    lowHarm : int</span>
<span class="sd">        Lowest harmonic component number.</span>
<span class="sd">    highHarm : int</span>
<span class="sd">        Highest harmonic component number.</span>
<span class="sd">    spectrumLevel : float</span>
<span class="sd">        The spectrum level of the noise from which</span>
<span class="sd">        the complex is derived in dB SPL.</span>
<span class="sd">    bandwidth : float</span>
<span class="sd">        Bandwidth of the frequency regions in which the</span>
<span class="sd">        phase transitions occurr.</span>
<span class="sd">    phaseRelationship : string (&#39;NoSpi&#39; or &#39;NpiSo&#39;)</span>
<span class="sd">        If NoSpi, the phase of the regions within each frequency band will</span>
<span class="sd">        be shifted. If NpiSo, the phase of the regions between each</span>
<span class="sd">        frequency band will be shifted.</span>
<span class="sd">    noiseType : string (&#39;White&#39; or &#39;Pink&#39;)</span>
<span class="sd">        The type of noise used to derive the Huggins Pitch.</span>
<span class="sd">    duration : float</span>
<span class="sd">        Complex duration (excluding ramps) in milliseconds.</span>
<span class="sd">    ramp : float</span>
<span class="sd">        Duration of the onset and offset ramps in milliseconds.</span>
<span class="sd">        The total duration of the sound will be duration+ramp*2.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>
<span class="sd">    maxLevel : float</span>
<span class="sd">        Level in dB SPL output by the soundcard for a sinusoid of amplitude 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">        The array has dimensions (nSamples, 2).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; hp = makeHuggins(F0=200, lowHarm=1, highHarm=5, spectrumLevel=40,</span>
<span class="sd">            bandwidth=65, phaseRelationship=&#39;NoSpi&#39;, noiseType=&#39;White&#39;,</span>
<span class="sd">            duration=280, ramp=10, fs=48000, maxLevel=100)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
   
    <span class="n">sDuration</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c">#convert from ms to sec</span>
    <span class="n">sRamp</span> <span class="o">=</span> <span class="n">ramp</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="n">totDur</span> <span class="o">=</span> <span class="n">sDuration</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sRamp</span><span class="p">)</span>
    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sDuration</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nRamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sRamp</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nTot</span> <span class="o">=</span> <span class="n">nSamples</span> <span class="o">+</span> <span class="p">(</span><span class="n">nRamp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">snd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="n">tone</span> <span class="o">=</span> <span class="n">broadbandNoise</span><span class="p">(</span><span class="n">spectrumLevel</span><span class="p">,</span> <span class="n">duration</span><span class="o">+</span><span class="p">(</span><span class="n">ramp</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Both&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">noiseType</span> <span class="o">==</span> <span class="s">&quot;Pink&quot;</span><span class="p">:</span>
        <span class="n">makePink</span><span class="p">(</span><span class="n">tone</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lowHarm</span><span class="p">,</span> <span class="n">highHarm</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">phaseRelationship</span> <span class="o">==</span> <span class="s">&quot;NoSpi&quot;</span><span class="p">:</span>
            <span class="c">#print(&quot;NoSpi&quot;)</span>
            <span class="n">tone</span> <span class="o">=</span> <span class="n">phaseShift</span><span class="p">(</span><span class="n">tone</span><span class="p">,</span> <span class="p">((</span><span class="n">i</span><span class="o">*</span><span class="n">F0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">bandwidth</span><span class="o">/</span><span class="mi">2</span><span class="p">)),</span> <span class="p">((</span><span class="n">i</span><span class="o">*</span><span class="n">F0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">bandwidth</span><span class="o">/</span><span class="mi">2</span><span class="p">)),</span> <span class="n">pi</span><span class="p">,</span> <span class="s">&quot;Left&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">phaseRelationship</span> <span class="o">==</span> <span class="s">&quot;NpiSo&quot;</span><span class="p">:</span>
            <span class="c">#print(&quot;NpiSo&quot;)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">lowHarm</span><span class="p">:</span>
                <span class="n">tone</span> <span class="o">=</span> <span class="n">phaseShift</span><span class="p">(</span><span class="n">tone</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">F0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">bandwidth</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">pi</span><span class="p">,</span> <span class="s">&quot;Left&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">highHarm</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">tone</span> <span class="o">=</span> <span class="n">phaseShift</span><span class="p">(</span><span class="n">tone</span><span class="p">,</span> <span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">F0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">bandwidth</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">F0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">bandwidth</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">pi</span><span class="p">,</span> <span class="s">&quot;Left&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
                <span class="n">tone</span> <span class="o">=</span> <span class="n">phaseShift</span><span class="p">(</span><span class="n">tone</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">F0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">bandwidth</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">fs</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="s">&quot;Left&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tone</span> <span class="o">=</span> <span class="n">phaseShift</span><span class="p">(</span><span class="n">tone</span><span class="p">,</span> <span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">F0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">bandwidth</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">F0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">bandwidth</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">pi</span><span class="p">,</span> <span class="s">&quot;Left&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
    
    <span class="n">tone</span> <span class="o">=</span> <span class="n">gate</span><span class="p">(</span><span class="n">ramp</span><span class="p">,</span> <span class="n">tone</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>    
    <span class="n">snd</span> <span class="o">=</span> <span class="n">tone</span>

    <span class="k">return</span> <span class="n">snd</span>
</div>
<div class="viewcode-block" id="makePink"><a class="viewcode-back" href="../index.html#sndlib.makePink">[docs]</a><span class="k">def</span> <span class="nf">makePink</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a white noise into a pink noise.</span>

<span class="sd">    The spectrum level of the pink noise at 1000 Hz will be equal to</span>
<span class="sd">    the spectrum level of the white noise input to the function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sig : array of floats</span>
<span class="sd">        The white noise to be turned into a pink noise.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Sampling frequency of the sound.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">        The array has dimensions (nSamples, 2).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">     &gt;&gt;&gt; noise = broadbandNoise(spectrumLevel=40, duration=180, ramp=10,</span>
<span class="sd">     ...     channel=&#39;Both&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">     &gt;&gt;&gt; noise = makePink(sig=noise, fs=48000)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">nSamples</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">nSamples</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">rfft</span><span class="p">(</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">nSamples</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">mag</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)])</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">ref</span><span class="o">/</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">mag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">*</span> <span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1j</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">))</span>
    
        <span class="n">sig0</span> <span class="o">=</span> <span class="n">irfft</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nSamples</span><span class="p">)</span>


        <span class="n">x</span> <span class="o">=</span> <span class="n">rfft</span><span class="p">(</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">nSamples</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">mag</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)])</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">ref</span><span class="o">/</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">mag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">*</span> <span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1j</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">))</span>

        <span class="n">sig1</span> <span class="o">=</span> <span class="n">irfft</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nSamples</span><span class="p">)</span>

        <span class="n">sig</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sig0</span>
        <span class="n">sig</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sig1</span>
    
    <span class="k">return</span> <span class="n">sig</span>


</div>
<div class="viewcode-block" id="makePinkRef"><a class="viewcode-back" href="../index.html#sndlib.makePinkRef">[docs]</a><span class="k">def</span> <span class="nf">makePinkRef</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">refHz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a white noise into a pink noise.</span>

<span class="sd">    The spectrum level of the pink noise at the frequency &#39;refHz&#39;</span>
<span class="sd">    will be equal to the spectrum level of the white noise input</span>
<span class="sd">    to the function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sig : array of floats</span>
<span class="sd">        The white noise to be turned into a pink noise.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Sampling frequency of the sound.</span>
<span class="sd">    refHz : int</span>
<span class="sd">        Reference frequency in Hz. The amplitude of the other</span>
<span class="sd">        frequencies will be scaled with respect to the amplitude</span>
<span class="sd">        of this frequency.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">        The array has dimensions (nSamples, 2).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">     &gt;&gt;&gt; noise = broadbandNoise(spectrumLevel=40, duration=180, ramp=10,</span>
<span class="sd">     ...     channel=&#39;Both&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">     &gt;&gt;&gt; noise = makePink(sig=noise, fs=48000, refHz=1000)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ref</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">refHz</span> <span class="o">*</span> <span class="n">nSamples</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">rfft</span><span class="p">(</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">mag</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">mag</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)])</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">ref</span><span class="o">/</span><span class="n">idx</span><span class="p">)</span>
    <span class="n">mag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ph</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">*</span> <span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1j</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">))</span>
    
    <span class="n">sig0</span> <span class="o">=</span> <span class="n">irfft</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


    <span class="n">x</span> <span class="o">=</span> <span class="n">rfft</span><span class="p">(</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">mag</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">mag</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)])</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">ref</span><span class="o">/</span><span class="n">idx</span><span class="p">)</span>
    <span class="n">mag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ph</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">*</span> <span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1j</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">))</span>

    <span class="n">sig1</span> <span class="o">=</span> <span class="n">irfft</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">sig</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sig0</span>
    <span class="n">sig</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sig1</span>
    
    <span class="k">return</span> <span class="n">sig</span>

</div>
<div class="viewcode-block" id="makeSilence"><a class="viewcode-back" href="../index.html#sndlib.makeSilence">[docs]</a><span class="k">def</span> <span class="nf">makeSilence</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a silence.</span>

<span class="sd">    This function just fills an array with zeros for the</span>
<span class="sd">    desired duration.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    duration : float</span>
<span class="sd">        Duration of the silence in milliseconds.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">        The array has dimensions (nSamples, 2).</span>
<span class="sd">       </span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; sil = makeSilence(duration=200, fs=48000)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#duration in ms</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c">#convert from ms to sec</span>
    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">snd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">snd</span>
</div>
<div class="viewcode-block" id="makeSimpleDichotic"><a class="viewcode-back" href="../index.html#sndlib.makeSimpleDichotic">[docs]</a><span class="k">def</span> <span class="nf">makeSimpleDichotic</span><span class="p">(</span><span class="n">F0</span><span class="p">,</span> <span class="n">lowHarm</span><span class="p">,</span> <span class="n">highHarm</span><span class="p">,</span> <span class="n">cmpLevel</span><span class="p">,</span> <span class="n">lowFreq</span><span class="p">,</span> <span class="n">highFreq</span><span class="p">,</span> <span class="n">spacing</span><span class="p">,</span> <span class="n">sigBandwidth</span><span class="p">,</span> <span class="n">phaseRelationship</span><span class="p">,</span> <span class="n">dichoticDifference</span><span class="p">,</span> <span class="n">itd</span><span class="p">,</span> <span class="n">ipd</span><span class="p">,</span> <span class="n">narrowBandCmpLevel</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate harmonically related dichotic pitches, or equivalent</span>
<span class="sd">    harmonically related narrowband tones in noise.</span>

<span class="sd">    This function generates first a pink noise by adding closely spaced</span>
<span class="sd">    sinusoids in a wide frequency range. Then, it can apply an interaural</span>
<span class="sd">    time difference (ITD), an interaural phase difference (IPD) or a</span>
<span class="sd">    level increase to harmonically related narrow frequency bands</span>
<span class="sd">    within the noise. In the first two cases (ITD and IPD) the result</span>
<span class="sd">    is a dichotic pitch. In the last case the pitch can also be heard</span>
<span class="sd">    monaurally; adjusting the level increase its salience can be closely</span>
<span class="sd">    matched to that of a dichotic pitch.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    F0 : float</span>
<span class="sd">        Centre frequency of the fundamental in hertz.</span>
<span class="sd">    lowHarm : int</span>
<span class="sd">        Lowest harmonic component number.</span>
<span class="sd">    highHarm : int</span>
<span class="sd">        Highest harmonic component number.</span>
<span class="sd">    cmpLevel : float</span>
<span class="sd">        Level of each sinusoidal frequency component of the noise.</span>
<span class="sd">    lowFreq : float</span>
<span class="sd">        Lowest frequency in hertz of the noise.</span>
<span class="sd">    highFreq : float</span>
<span class="sd">        Highest frequency in hertz of the noise.</span>
<span class="sd">    spacing : float</span>
<span class="sd">        Spacing in cents between the sinusoidal components used to generate the</span>
<span class="sd">        noise.</span>
<span class="sd">    sigBandwidth : float</span>
<span class="sd">        Width in cents of each harmonically related frequency band.</span>
<span class="sd">    phaseRelationship : string (&#39;NoSpi&#39; or &#39;NpiSo&#39;)</span>
<span class="sd">        If NoSpi, the phase of the regions within each frequency band will</span>
<span class="sd">        be shifted. If NpiSo, the phase of the regions between each</span>
<span class="sd">        frequency band will be shifted.</span>
<span class="sd">    dichoticDifference : string (one of &#39;IPD&#39;, &#39;ITD&#39;, &#39;Level&#39;)</span>
<span class="sd">        The manipulation to apply to the heramonically related</span>
<span class="sd">        frequency bands. </span>
<span class="sd">    itd : float</span>
<span class="sd">        Interaural time difference in microseconds to apply</span>
<span class="sd">        to the harmonically related frequency bands. Applied</span>
<span class="sd">        only if &#39;dichoticDifference&#39; is &#39;ITD&#39;.</span>
<span class="sd">    ipd : float</span>
<span class="sd">        Interaural phase difference in radians to apply</span>
<span class="sd">        to the harmonically related frequency bands. Applied</span>
<span class="sd">        only if &#39;dichoticDifference&#39; is &#39;IPD&#39;.</span>
<span class="sd">    narrowBandCmpLevel : float</span>
<span class="sd">        Level of the sinusoidal components in the frequency bands.</span>
<span class="sd">        If the &#39;narrowBandCmpLevel&#39; is greater than the level</span>
<span class="sd">        of the background noise (&#39;cmpLevel&#39;), a complex tone</span>
<span class="sd">        consisting of narrowband noises in noise will be generated.</span>
<span class="sd">    duration : float</span>
<span class="sd">        Sound duration (excluding ramps) in milliseconds.</span>
<span class="sd">    ramp : float</span>
<span class="sd">        Duration of the onset and offset ramps in milliseconds.</span>
<span class="sd">        The total duration of the sound will be duration+ramp*2.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>
<span class="sd">    maxLevel : float</span>
<span class="sd">        Level in dB SPL output by the soundcard for a sinusoid of amplitude 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">        The array has dimensions (nSamples, 2).</span>
<span class="sd">       </span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; s1 = makeSimpleDichotic(F0=250, lowHarm=1, highHarm=3, cmpLevel=30,</span>
<span class="sd">        lowFreq=40, highFreq=1200, spacing=10, sigBandwidth=100,</span>
<span class="sd">        phaseRelationship=&#39;NoSpi&#39;, dichoticDifference=&#39;IPD&#39;, itd=0,</span>
<span class="sd">        ipd=3.14, narrowBandCmpLevel=0, duration=280, ramp=10,</span>
<span class="sd">        fs=48000, maxLevel=100)</span>

<span class="sd">    &quot;&quot;&quot;</span><span class="s">&quot;&quot;&quot; </span>

<span class="s">    Keyword arguments:</span>
<span class="s">    F0 -- Fundamental frequency (Hz)</span>
<span class="s">    lowHarm -- Number of the lowest harmonic</span>
<span class="s">    highHarm -- Number of the highest harmonic</span>
<span class="s">    cmpLevel -- level in dB SPL of each sinusoid that makes up the noise</span>
<span class="s">    lowCmp -- lowest frequency (Hz)</span>
<span class="s">    highCmp -- highest frequency (Hz)</span>
<span class="s">    spacing -- spacing between frequency components (Cents)</span>
<span class="s">    sigBandwidth -- bandwidth of each harmonic band (Cents)</span>
<span class="s">    phaseRelationship -- NoSpi or NpiSo</span>
<span class="s">    dichotic difference -- IPD, ITD or Level</span>
<span class="s">    itd -- interaural time difference microseconds</span>
<span class="s">    ipd -- interaural phase difference in radians</span>
<span class="s">    narrowBandCmpLevel - level of frequency components in the harmonic bands (valid only if dichotic difference is Level)</span>
<span class="s">    duration -- duration (excluding ramps) in ms</span>
<span class="s">    ramp -- ramp duration in ms</span>
<span class="s">    fs -- sampling frequency</span>
<span class="s">    maxLevel --</span>
<span class="s">    </span>
<span class="s">    &quot;&quot;&quot;</span>
    
    <span class="n">sDuration</span> <span class="o">=</span> <span class="n">duration</span><span class="o">/</span><span class="mi">1000</span> <span class="c">#convert from ms to sec</span>
    <span class="n">sRamp</span> <span class="o">=</span> <span class="n">ramp</span><span class="o">/</span><span class="mi">1000</span>

    <span class="n">totDur</span> <span class="o">=</span> <span class="n">sDuration</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sRamp</span><span class="p">)</span>
    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sDuration</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nRamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sRamp</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nTot</span> <span class="o">=</span> <span class="n">nSamples</span> <span class="o">+</span> <span class="p">(</span><span class="n">nRamp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">timeAll</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nTot</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>
    <span class="n">timeRamp</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nRamp</span><span class="p">)</span> 
    <span class="n">snd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">noisBandwidth</span> <span class="o">=</span> <span class="mi">1200</span><span class="o">*</span><span class="n">log2</span><span class="p">(</span><span class="n">highFreq</span><span class="o">/</span><span class="n">lowFreq</span><span class="p">)</span> <span class="c">#in cents</span>
    <span class="n">nComponents</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">noisBandwidth</span><span class="o">/</span><span class="n">spacing</span><span class="p">))</span>
    
    <span class="n">amp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">cmpLevel</span> <span class="o">-</span> <span class="n">maxLevel</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">nComponents</span><span class="p">)</span>
    <span class="n">freqs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lowFreq</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nComponents</span><span class="p">):</span> <span class="c">#indexing starts from 1</span>
        <span class="n">freqs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">freqs</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">spacing</span><span class="o">/</span><span class="mi">1200</span><span class="p">))</span>

    <span class="n">phasesR</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">nComponents</span><span class="p">)</span>
    <span class="n">sinArray</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nComponents</span><span class="p">,</span> <span class="n">nTot</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nComponents</span><span class="p">):</span>
        <span class="n">sinArray</span><span class="p">[</span><span class="n">i</span><span class="p">,]</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">freqs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">timeAll</span> <span class="o">+</span> <span class="n">phasesR</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">freqsToShift</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">nCompsXBand</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lowHarm</span><span class="p">,</span> <span class="n">highHarm</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">thisFreq</span> <span class="o">=</span> <span class="n">F0</span><span class="o">*</span><span class="n">i</span><span class="p">;</span>
        <span class="n">prevFreq</span> <span class="o">=</span> <span class="n">F0</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">lo</span> <span class="o">=</span> <span class="n">thisFreq</span><span class="o">*</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">sigBandwidth</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">1200</span><span class="p">)</span>
        <span class="n">hi</span> <span class="o">=</span> <span class="n">thisFreq</span><span class="o">*</span><span class="mi">2</span><span class="o">**</span><span class="p">((</span><span class="n">sigBandwidth</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">1200</span><span class="p">)</span>
        <span class="n">hiPrev</span> <span class="o">=</span> <span class="n">prevFreq</span><span class="o">*</span><span class="mi">2</span><span class="o">**</span><span class="p">((</span><span class="n">sigBandwidth</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">1200</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">phaseRelationship</span> <span class="o">==</span> <span class="s">&quot;NoSpi&quot;</span><span class="p">:</span>
            <span class="n">thisFreqsToShift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">freqs</span><span class="o">&gt;</span><span class="n">lo</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">freqs</span><span class="o">&lt;</span><span class="n">hi</span><span class="p">))</span>
            <span class="n">freqsToShift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">freqsToShift</span><span class="p">,</span> <span class="n">thisFreqsToShift</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">phaseRelationship</span> <span class="o">==</span> <span class="s">&quot;NpiSo&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">thisFreqsToShift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">freqs</span><span class="o">&gt;</span><span class="n">lowFreq</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">freqs</span><span class="o">&lt;</span><span class="n">lo</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thisFreqsToShift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">freqs</span><span class="o">&gt;</span><span class="n">hiPrev</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">freqs</span><span class="o">&lt;</span><span class="n">lo</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">highHarm</span><span class="p">:</span>
                <span class="n">foo</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">freqs</span><span class="o">&gt;</span><span class="n">hi</span><span class="p">)</span>
                <span class="n">thisFreqsToShift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisFreqsToShift</span><span class="p">,</span> <span class="n">foo</span><span class="p">)</span>
            <span class="n">freqsToShift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">freqsToShift</span><span class="p">,</span> <span class="n">thisFreqsToShift</span><span class="p">)</span>
                
                
    <span class="n">sinArrayLeft</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">sinArray</span><span class="p">)</span>
   
    <span class="k">if</span> <span class="n">dichoticDifference</span> <span class="o">==</span> <span class="s">&quot;IPD&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">freqsToShift</span><span class="p">)):</span>
            <span class="n">sinArrayLeft</span><span class="p">[</span><span class="n">freqsToShift</span><span class="p">[</span><span class="n">i</span><span class="p">],]</span> <span class="o">=</span>  <span class="n">amp</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">freqs</span><span class="p">[</span><span class="n">freqsToShift</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">timeAll</span> <span class="o">+</span> <span class="p">(</span><span class="n">phasesR</span><span class="p">[</span><span class="n">freqsToShift</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">+</span><span class="n">ipd</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">dichoticDifference</span> <span class="o">==</span> <span class="s">&quot;ITD&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">freqsToShift</span><span class="p">)):</span>
            <span class="n">thisIpd</span> <span class="o">=</span> <span class="n">itdtoipd</span><span class="p">(</span><span class="n">itd</span><span class="o">/</span><span class="mf">1000000.</span><span class="p">,</span> <span class="n">freqs</span><span class="p">[</span><span class="n">freqsToShift</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
            <span class="n">sinArrayLeft</span><span class="p">[</span><span class="n">freqsToShift</span><span class="p">[</span><span class="n">i</span><span class="p">],]</span> <span class="o">=</span>  <span class="n">amp</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">freqs</span><span class="p">[</span><span class="n">freqsToShift</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">timeAll</span> <span class="o">+</span> <span class="p">(</span><span class="n">phasesR</span><span class="p">[</span><span class="n">freqsToShift</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">+</span><span class="n">thisIpd</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">dichoticDifference</span> <span class="o">==</span> <span class="s">&quot;Level&quot;</span><span class="p">:</span>
        <span class="n">amp2</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">narrowBandCmpLevel</span> <span class="o">-</span> <span class="n">maxLevel</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">);</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">freqsToShift</span><span class="p">)):</span>
            <span class="n">sinArrayLeft</span><span class="p">[</span><span class="n">freqsToShift</span><span class="p">[</span><span class="n">i</span><span class="p">],]</span>  <span class="o">=</span> <span class="n">amp2</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">freqs</span><span class="p">[</span><span class="n">freqsToShift</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">timeAll</span> <span class="o">+</span> <span class="n">phasesR</span><span class="p">[</span><span class="n">freqsToShift</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
        <span class="c"># raise the levels of the narrow band in both the right and left ears</span>
        <span class="n">sinArray</span> <span class="o">=</span> <span class="n">sinArrayLeft</span>
    <span class="n">snd</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sinArray</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">snd</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sinArrayLeft</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">snd</span> <span class="o">=</span> <span class="n">gate</span><span class="p">(</span><span class="n">ramp</span><span class="p">,</span> <span class="n">snd</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">snd</span>


<span class="c">## def makeToneSequenceWithJitter(nTones, tonesFreq, tonesLevel, tonesDuration, tonesRamps, tonesChannel, ISI, jitter, fs, maxLevel):</span>
<span class="c">##     &quot;&quot;&quot;</span>
<span class="c">##     Sum a set of pure tones with a jittered onset.</span>

<span class="c">##     Parameters</span>
<span class="c">##     ----------</span>
<span class="c">##     nTones : int</span>
        
<span class="c">##     Returns</span>
<span class="c">##     ----------</span>

    
<span class="c">##     &quot;&quot;&quot;</span>
<span class="c">##     tonesTotalDuration = tonesDuration + tonesRamps*2</span>
<span class="c">##     soundSequenceDuration = jitter*2 + tonesTotalDuration*nTones + ISI*(nTones-1)</span>
<span class="c">##     soundSequence = makeSilence(soundSequenceDuration, fs)</span>
<span class="c">##     thisTone = pureTone(tonesFreq, 0, tonesLevel, tonesDuration, tonesRamps, tonesChannel, fs, maxLevel)</span>
<span class="c">##     toneOnsets = numpy.zeros(nTones)</span>
<span class="c">##     for i in range(nTones):</span>
<span class="c">##         toneOnsets[i] = jitter + i*(tonesTotalDuration+ISI)</span>
<span class="c">##     toneOnsets = toneOnsets + numpy.random.uniform(-jitter, jitter, nTones)</span>
<span class="c">##     for i in range(nTones):</span>
<span class="c">##         soundSequence = addSounds(soundSequence, thisTone, toneOnsets[i], fs)</span>

<span class="c">##     return soundSequence</span>

</div>
<div class="viewcode-block" id="nextpow2"><a class="viewcode-back" href="../index.html#sndlib.nextpow2">[docs]</a><span class="k">def</span> <span class="nf">nextpow2</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Next power of two.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : int</span>
<span class="sd">        Base number.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : float</span>
<span class="sd">        The power to which 2 should be raised.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; nextpow2(511)</span>
<span class="sd">    9</span>
<span class="sd">    &gt;&gt;&gt; 2**9</span>
<span class="sd">    512</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">log2</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">out</span>
<span class="c">#def nextpow2(i):</span>
<span class="c">#    n = 2</span>
<span class="c">#    while n &lt; i:</span>
<span class="c">#        n = n * 2</span>
<span class="c">#    return n</span>


</div>
<div class="viewcode-block" id="phaseShift"><a class="viewcode-back" href="../index.html#sndlib.phaseShift">[docs]</a><span class="k">def</span> <span class="nf">phaseShift</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">phase_shift</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shift the phases of a sound within a given frequency region.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sig : array of floats</span>
<span class="sd">        Input signal.</span>
<span class="sd">    f1 : float</span>
<span class="sd">        The start point of the frequency region to be</span>
<span class="sd">        phase-shifted in hertz.</span>
<span class="sd">    f2 : float</span>
<span class="sd">        The end point of the frequency region to be</span>
<span class="sd">        phase-shifted in hertz.</span>
<span class="sd">    phase_shift : float</span>
<span class="sd">        The amount of phase shift in radians.</span>
<span class="sd">    channel : string (one of &#39;Right&#39;, &#39;Left&#39; or &#39;Both&#39;)</span>
<span class="sd">        The channel in which to apply the phase shift.</span>
<span class="sd">    fs : float</span>
<span class="sd">        The sampling frequency of the sound.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : 2-dimensional array of floats</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; noise = broadbandNoise(spectrumLevel=40, duration=180, ramp=10,</span>
<span class="sd">    ...     channel=&#39;Both&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">    &gt;&gt;&gt; hp = phaseShift(sig=noise, f1=500, f2=600, phase_shift=3.14,</span>
<span class="sd">            channel=&#39;Left&#39;, fs=48000) #this generates a Dichotic Pitch</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">fftPoints</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">nextpow2</span><span class="p">(</span><span class="n">nSamples</span><span class="p">)</span>

    <span class="c">#in Matlab 1+ to skip DC component, but python indexing starts from 0</span>
    <span class="n">start1</span> <span class="o">=</span>  <span class="nb">round</span><span class="p">(</span><span class="n">f1</span> <span class="o">*</span> <span class="n">fftPoints</span> <span class="o">/</span> <span class="n">fs</span><span class="p">)</span>
    <span class="n">end1</span>   <span class="o">=</span>  <span class="nb">round</span><span class="p">(</span><span class="n">f2</span> <span class="o">*</span> <span class="n">fftPoints</span> <span class="o">/</span> <span class="n">fs</span><span class="p">)</span>
    <span class="c"># symmetric points, for Matlab need to add 2 to skip DC component and because start1 subtracts one point more</span>
    <span class="n">start2</span> <span class="o">=</span> <span class="n">fftPoints</span> <span class="o">-</span> <span class="n">start1</span>
    <span class="n">end2</span> <span class="o">=</span> <span class="n">fftPoints</span> <span class="o">-</span> <span class="n">end1</span>
    <span class="n">snd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">fftPoints</span><span class="p">)</span>
        <span class="n">pnts</span> <span class="o">=</span> <span class="n">int_</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="n">start1</span><span class="p">,</span> <span class="n">end1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">pnts</span><span class="p">])</span>
        <span class="n">newPhase</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">pnts</span><span class="p">)</span> <span class="o">+</span> <span class="n">phase_shift</span>
        <span class="n">x</span><span class="p">[</span><span class="n">pnts</span><span class="p">]</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">*</span> <span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">newPhase</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1j</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">newPhase</span><span class="p">)))</span>

        <span class="n">pnts</span> <span class="o">=</span> <span class="n">int_</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="n">end2</span><span class="p">,</span> <span class="n">start2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">pnts</span><span class="p">])</span>
        <span class="n">newPhase</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">pnts</span><span class="p">)</span> <span class="o">-</span> <span class="n">phase_shift</span>
        <span class="n">x</span><span class="p">[</span><span class="n">pnts</span><span class="p">]</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">*</span> <span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">newPhase</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1j</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">newPhase</span><span class="p">)))</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">real</span><span class="p">(</span><span class="n">ifft</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">snd</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">snd</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sig</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">fftPoints</span><span class="p">)</span>
        <span class="n">pnts</span> <span class="o">=</span> <span class="n">int_</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="n">start1</span><span class="p">,</span> <span class="n">end1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">pnts</span><span class="p">])</span>
        <span class="n">newPhase</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">pnts</span><span class="p">)</span> <span class="o">+</span> <span class="n">phase_shift</span>
        <span class="n">x</span><span class="p">[</span><span class="n">pnts</span><span class="p">]</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">*</span> <span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">newPhase</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1j</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">newPhase</span><span class="p">)))</span>

        <span class="n">pnts</span> <span class="o">=</span> <span class="n">int_</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="n">end2</span><span class="p">,</span> <span class="n">start2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">pnts</span><span class="p">])</span>
        <span class="n">newPhase</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">pnts</span><span class="p">)</span> <span class="o">-</span> <span class="n">phase_shift</span>
        <span class="n">x</span><span class="p">[</span><span class="n">pnts</span><span class="p">]</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">*</span> <span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">newPhase</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1j</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">newPhase</span><span class="p">)))</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">real</span><span class="p">(</span><span class="n">ifft</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">snd</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">snd</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sig</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">fftPoints</span><span class="p">)</span>
        <span class="n">pnts</span> <span class="o">=</span> <span class="n">int_</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="n">start1</span><span class="p">,</span> <span class="n">end1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">pnts</span><span class="p">])</span>
        <span class="n">newPhase</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">pnts</span><span class="p">)</span> <span class="o">+</span> <span class="n">phase_shift</span>
        <span class="n">x</span><span class="p">[</span><span class="n">pnts</span><span class="p">]</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">*</span> <span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">newPhase</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1j</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">newPhase</span><span class="p">)))</span>

        <span class="n">pnts</span> <span class="o">=</span> <span class="n">int_</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="n">end2</span><span class="p">,</span> <span class="n">start2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">pnts</span><span class="p">])</span>
        <span class="n">newPhase</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">pnts</span><span class="p">)</span> <span class="o">-</span> <span class="n">phase_shift</span>
        <span class="n">x</span><span class="p">[</span><span class="n">pnts</span><span class="p">]</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">*</span> <span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">newPhase</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1j</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">newPhase</span><span class="p">)))</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">real</span><span class="p">(</span><span class="n">ifft</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">snd</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">fftPoints</span><span class="p">)</span>
        <span class="n">pnts</span> <span class="o">=</span> <span class="n">int_</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="n">start1</span><span class="p">,</span> <span class="n">end1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">pnts</span><span class="p">])</span>
        <span class="n">newPhase</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">pnts</span><span class="p">)</span> <span class="o">+</span> <span class="n">phase_shift</span>
        <span class="n">x</span><span class="p">[</span><span class="n">pnts</span><span class="p">]</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">*</span> <span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">newPhase</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1j</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">newPhase</span><span class="p">)))</span>

        <span class="n">pnts</span> <span class="o">=</span> <span class="n">int_</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="n">end2</span><span class="p">,</span> <span class="n">start2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">pnts</span><span class="p">])</span>
        <span class="n">newPhase</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">pnts</span><span class="p">)</span> <span class="o">-</span> <span class="n">phase_shift</span>
        <span class="n">x</span><span class="p">[</span><span class="n">pnts</span><span class="p">]</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">*</span> <span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">newPhase</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1j</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">newPhase</span><span class="p">)))</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">real</span><span class="p">(</span><span class="n">ifft</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">snd</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">snd</span>

</div>
<div class="viewcode-block" id="pinkNoiseFromSin"><a class="viewcode-back" href="../index.html#sndlib.pinkNoiseFromSin">[docs]</a><span class="k">def</span> <span class="nf">pinkNoiseFromSin</span><span class="p">(</span><span class="n">compLevel</span><span class="p">,</span> <span class="n">lowCmp</span><span class="p">,</span> <span class="n">highCmp</span><span class="p">,</span> <span class="n">spacing</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a pink noise by adding sinusoids spaced by a fixed</span>
<span class="sd">    interval in cents.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    compLevel : float</span>
<span class="sd">        Level of each sinusoidal component in dB SPL.</span>
<span class="sd">    lowCmp : float</span>
<span class="sd">        Frequency of the lowest noise component in hertz.</span>
<span class="sd">    highCmp : float</span>
<span class="sd">        Frequency of the highest noise component in hertz.</span>
<span class="sd">    spacing : float</span>
<span class="sd">        Spacing between the frequencies of the sinusoidal components</span>
<span class="sd">        in hertz.</span>
<span class="sd">    duration : float</span>
<span class="sd">        Noise duration (excluding ramps) in milliseconds.</span>
<span class="sd">    ramp : float</span>
<span class="sd">        Duration of the onset and offset ramps in milliseconds.</span>
<span class="sd">        The total duration of the sound will be duration+ramp*2.</span>
<span class="sd">    channel : string (&#39;Right&#39;, &#39;Left&#39; or &#39;Both&#39;)</span>
<span class="sd">        Channel in which the noise will be generated.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>
<span class="sd">    maxLevel : float</span>
<span class="sd">        Level in dB SPL output by the soundcard for a sinusoid of amplitude 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">        The array has dimensions (nSamples, 2).</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; noise = pinkNoiseFromSin(compLevel=23, lowCmp=100, highCmp=1000,</span>
<span class="sd">        spacing=20, duration=180, ramp=10, channel=&#39;Both&#39;,</span>
<span class="sd">        fs=48000, maxLevel=100)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">sDuration</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c">#convert from ms to sec</span>
    <span class="n">sRamp</span> <span class="o">=</span> <span class="n">ramp</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="n">totDur</span> <span class="o">=</span> <span class="n">sDuration</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sRamp</span><span class="p">)</span>
    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sDuration</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nRamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sRamp</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nTot</span> <span class="o">=</span> <span class="n">nSamples</span> <span class="o">+</span> <span class="p">(</span><span class="n">nRamp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">timeAll</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nTot</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>
    <span class="n">timeRamp</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nRamp</span><span class="p">)</span> 
    <span class="n">snd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">noisBandwidth</span> <span class="o">=</span> <span class="mi">1200</span><span class="o">*</span><span class="n">log2</span><span class="p">(</span><span class="n">highCmp</span><span class="o">/</span><span class="n">lowCmp</span><span class="p">)</span> <span class="c">#in cents</span>
    <span class="n">nComponents</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">noisBandwidth</span><span class="o">/</span><span class="n">spacing</span><span class="p">))</span>
    <span class="n">amp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">compLevel</span> <span class="o">-</span> <span class="n">maxLevel</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">nComponents</span><span class="p">)</span>
    <span class="n">freqs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lowCmp</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nComponents</span><span class="p">):</span> <span class="c">#indexing starts from 1</span>
        <span class="n">freqs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">freqs</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">spacing</span><span class="o">/</span><span class="mf">1200.</span><span class="p">))</span>

    <span class="n">phasesR</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">nComponents</span><span class="p">)</span>
    <span class="n">sinArray</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nComponents</span><span class="p">,</span> <span class="n">nTot</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nComponents</span><span class="p">):</span>
        <span class="n">sinArray</span><span class="p">[</span><span class="n">i</span><span class="p">,]</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">freqs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">timeAll</span> <span class="o">+</span> <span class="n">phasesR</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
    <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sinArray</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sinArray</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sinArray</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">snd</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">snd</span> <span class="o">=</span> <span class="n">gate</span><span class="p">(</span><span class="n">ramp</span><span class="p">,</span> <span class="n">snd</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>    
    <span class="k">return</span> <span class="n">snd</span>

</div>
<div class="viewcode-block" id="pinkNoiseFromSin2"><a class="viewcode-back" href="../index.html#sndlib.pinkNoiseFromSin2">[docs]</a><span class="k">def</span> <span class="nf">pinkNoiseFromSin2</span><span class="p">(</span><span class="n">compLevel</span><span class="p">,</span> <span class="n">lowCmp</span><span class="p">,</span> <span class="n">highCmp</span><span class="p">,</span> <span class="n">spacing</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a pink noise by adding sinusoids spaced by a fixed</span>
<span class="sd">    interval in cents.</span>

<span class="sd">    This function should produce the same output of pinkNoiseFromSin,</span>
<span class="sd">    it simply uses a different algorithm that uses matrix operations</span>
<span class="sd">    instead of a for loop. It doesn&#39;t seem to be much faster though.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    compLevel : float</span>
<span class="sd">        Level of each sinusoidal component in dB SPL.</span>
<span class="sd">    lowCmp : float</span>
<span class="sd">        Frequency of the lowest noise component in hertz.</span>
<span class="sd">    highCmp : float</span>
<span class="sd">        Frequency of the highest noise component in hertz.</span>
<span class="sd">    spacing : float</span>
<span class="sd">        Spacing between the frequencies of the sinusoidal components</span>
<span class="sd">        in hertz.</span>
<span class="sd">    duration : float</span>
<span class="sd">        Noise duration (excluding ramps) in milliseconds.</span>
<span class="sd">    ramp : float</span>
<span class="sd">        Duration of the onset and offset ramps in milliseconds.</span>
<span class="sd">        The total duration of the sound will be duration+ramp*2.</span>
<span class="sd">    channel : string (&#39;Right&#39;, &#39;Left&#39; or &#39;Both&#39;)</span>
<span class="sd">        Channel in which the noise will be generated.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>
<span class="sd">    maxLevel : float</span>
<span class="sd">        Level in dB SPL output by the soundcard for a sinusoid of amplitude 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">        The array has dimensions (nSamples, 2).</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; noise = pinkNoiseFromSin2(compLevel=23, lowCmp=100, highCmp=1000,</span>
<span class="sd">        spacing=20, duration=180, ramp=10, channel=&#39;Both&#39;,</span>
<span class="sd">        fs=48000, maxLevel=100)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">sDuration</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c">#convert from ms to sec</span>
    <span class="n">sRamp</span> <span class="o">=</span> <span class="n">ramp</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="n">totDur</span> <span class="o">=</span> <span class="n">sDuration</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sRamp</span><span class="p">)</span>
    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sDuration</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nRamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sRamp</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nTot</span> <span class="o">=</span> <span class="n">nSamples</span> <span class="o">+</span> <span class="p">(</span><span class="n">nRamp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">timeAll</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nTot</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>
    <span class="n">snd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">noisBandwidth</span> <span class="o">=</span> <span class="mi">1200</span><span class="o">*</span><span class="n">log2</span><span class="p">(</span><span class="n">highCmp</span><span class="o">/</span><span class="n">lowCmp</span><span class="p">)</span> <span class="c">#in cents</span>
    <span class="n">nComponents</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">noisBandwidth</span><span class="o">/</span><span class="n">spacing</span><span class="p">))</span>
    <span class="n">amp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">compLevel</span> <span class="o">-</span> <span class="n">maxLevel</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nComponents</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">freqs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lowCmp</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nComponents</span><span class="p">):</span> <span class="c">#indexing starts from 1</span>
        <span class="n">freqs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">freqs</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">spacing</span><span class="o">/</span><span class="mf">1200.</span><span class="p">))</span>
    <span class="c">#freqs = freqs.reshape(nComponents,1)</span>
    <span class="n">phasesR</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="p">(</span><span class="n">nComponents</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="c">#phasesR = phasesR.reshape(nComponents,1)</span>
    <span class="n">sinMatrix</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nComponents</span><span class="p">,</span> <span class="n">nTot</span><span class="p">))</span>
    <span class="n">timeMatrix</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nComponents</span><span class="p">,</span> <span class="n">nTot</span><span class="p">))</span>
    <span class="n">timeMatrix</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">timeAll</span>

    <span class="c">#for i in range(0, nComponents):</span>
    <span class="c">#    sinMatrix[i,] = amp* sin(2*pi*freqs[i] * timeAll + phasesR[i])</span>

    <span class="n">sinMatrix</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">freqs</span><span class="o">*</span><span class="n">timeMatrix</span><span class="o">+</span><span class="n">phasesR</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sinMatrix</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sinMatrix</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sinMatrix</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">snd</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">snd</span> <span class="o">=</span> <span class="n">gate</span><span class="p">(</span><span class="n">ramp</span><span class="p">,</span> <span class="n">snd</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>    
    <span class="k">return</span> <span class="n">snd</span>

</div>
<div class="viewcode-block" id="pureTone"><a class="viewcode-back" href="../index.html#sndlib.pureTone">[docs]</a><span class="k">def</span> <span class="nf">pureTone</span><span class="p">(</span><span class="n">frequency</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Synthetise a pure tone.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    frequency : float</span>
<span class="sd">        Tone frequency in hertz.</span>
<span class="sd">    phase : float</span>
<span class="sd">        Starting phase in radians.</span>
<span class="sd">    level : float</span>
<span class="sd">        Tone level in dB SPL.</span>
<span class="sd">    duration : float</span>
<span class="sd">        Tone duration (excluding ramps) in milliseconds.</span>
<span class="sd">    ramp : float</span>
<span class="sd">        Duration of the onset and offset ramps in milliseconds.</span>
<span class="sd">        The total duration of the sound will be duration+ramp*2.</span>
<span class="sd">    channel : string (&#39;Right&#39;, &#39;Left&#39; or &#39;Both&#39;)</span>
<span class="sd">        Channel in which the tone will be generated.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>
<span class="sd">    maxLevel : float</span>
<span class="sd">        Level in dB SPL output by the soundcard for a sinusoid of amplitude 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">        The array has dimensions (nSamples, 2).</span>
<span class="sd">       </span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; pt = pureTone(frequency=440, phase=0, level=65, duration=180,</span>
<span class="sd">    ...     ramp=10, channel=&#39;Right&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">    &gt;&gt;&gt; pt.shape</span>
<span class="sd">    (9600, 2)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">channel</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;Right&quot;</span><span class="p">,</span> <span class="s">&quot;Left&quot;</span><span class="p">,</span> <span class="s">&quot;Both&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid channel argument. Channel must be one of &#39;Right&#39;, &#39;Left&#39; or &#39;Both&#39;&quot;</span><span class="p">)</span>
    
    <span class="n">amp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">level</span> <span class="o">-</span> <span class="n">maxLevel</span><span class="p">)</span> <span class="o">/</span> <span class="mf">20.</span><span class="p">)</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c">#convert from ms to sec</span>
    <span class="n">ramp</span> <span class="o">=</span> <span class="n">ramp</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nRamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ramp</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nTot</span> <span class="o">=</span> <span class="n">nSamples</span> <span class="o">+</span> <span class="p">(</span><span class="n">nRamp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">timeAll</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nTot</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>
    <span class="n">timeRamp</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nRamp</span><span class="p">)</span> 

    <span class="n">snd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">snd</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">snd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
       

    <span class="k">return</span> <span class="n">snd</span>
</div>
<div class="viewcode-block" id="scale"><a class="viewcode-back" href="../index.html#sndlib.scale">[docs]</a><span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">sig</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Increase or decrease the amplitude of a sound signal.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    level : float</span>
<span class="sd">        Desired increment or decrement in dB SPL.</span>
<span class="sd">    signal : array of floats</span>
<span class="sd">        Signal to scale.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sig : 2-dimensional array of floats</span>
<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; noise = broadbandNoise(spectrumLevel=40, duration=180, ramp=10,</span>
<span class="sd">    ...     channel=&#39;Both&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">    &gt;&gt;&gt; noise = scale(level=-10, sig=noise) #reduce level by 10 dB</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#10**(level/20) is the amplitude corresponding to level</span>
    <span class="c">#by multiplying the amplitudes we&#39;re adding the decibels</span>
    <span class="c"># 20*log10(a1*a2) = 20*log10(a1) + 20*log10(a2)</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">sig</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">level</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sig</span>

</div>
<div class="viewcode-block" id="steepNoise"><a class="viewcode-back" href="../index.html#sndlib.steepNoise">[docs]</a><span class="k">def</span> <span class="nf">steepNoise</span><span class="p">(</span><span class="n">frequency1</span><span class="p">,</span> <span class="n">frequency2</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramp</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">maxLevel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Synthetise band-limited noise from the addition of random-phase</span>
<span class="sd">    sinusoids.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    frequency1 : float</span>
<span class="sd">        Start frequency of the noise.</span>
<span class="sd">    frequency2 : float</span>
<span class="sd">        End frequency of the noise.</span>
<span class="sd">    level : float</span>
<span class="sd">        Noise spectrum level.</span>
<span class="sd">    duration : float</span>
<span class="sd">        Tone duration (excluding ramps) in milliseconds.</span>
<span class="sd">    ramp : float</span>
<span class="sd">        Duration of the onset and offset ramps in milliseconds.</span>
<span class="sd">        The total duration of the sound will be duration+ramp*2.</span>
<span class="sd">    channel : string (&#39;Right&#39;, &#39;Left&#39; or &#39;Both&#39;)</span>
<span class="sd">        Channel in which the tone will be generated.</span>
<span class="sd">    fs : int</span>
<span class="sd">        Samplig frequency in Hz.</span>
<span class="sd">    maxLevel : float</span>
<span class="sd">        Level in dB SPL output by the soundcard for a sinusoid of amplitude 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    snd : 2-dimensional array of floats</span>
<span class="sd">        The array has dimensions (nSamples, 2).</span>
<span class="sd">       </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; nbNoise = steepNoise(frequency=440, frequency2=660, level=65,</span>
<span class="sd">    ...     duration=180, ramp=10, channel=&#39;Right&#39;, fs=48000, maxLevel=100)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span><span class="o">/</span><span class="mi">1000</span> <span class="c">#convert from ms to sec</span>
    <span class="n">ramp</span> <span class="o">=</span> <span class="n">ramp</span><span class="o">/</span><span class="mi">1000</span>

    <span class="n">totDur</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ramp</span><span class="p">)</span>
    <span class="n">nSamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nRamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ramp</span> <span class="o">*</span> <span class="n">fs</span><span class="p">))</span>
    <span class="n">nTot</span> <span class="o">=</span> <span class="n">nSamples</span> <span class="o">+</span> <span class="p">(</span><span class="n">nRamp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">spacing</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">totDur</span>
    <span class="n">components</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">floor</span><span class="p">((</span><span class="n">frequency2</span> <span class="o">-</span> <span class="n">frequency1</span><span class="p">)</span> <span class="o">/</span> <span class="n">spacing</span><span class="p">)</span>
    <span class="c"># SL = 10*log10(A^2/NHz) </span>
    <span class="c"># SL/10 = log10(A^2/NHz)</span>
    <span class="c"># 10^(SL/10) = A^2/NHz</span>
    <span class="c"># A^2 = 10^(SL/10) * NHz</span>
    <span class="c"># RMS = 10^(SL/20) * sqrt(NHz) where NHz is the spacing between harmonics</span>
    <span class="n">amp</span> <span class="o">=</span>  <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">level</span> <span class="o">-</span> <span class="n">maxLevel</span><span class="p">)</span> <span class="o">/</span> <span class="mf">20.</span><span class="p">)</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">frequency2</span> <span class="o">-</span> <span class="n">frequency1</span><span class="p">)</span> <span class="o">/</span> <span class="n">components</span><span class="p">)</span>
    
    <span class="n">timeAll</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nTot</span><span class="p">)</span> <span class="o">/</span> <span class="n">fs</span>
    <span class="n">timeRamp</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nRamp</span><span class="p">)</span>
    <span class="n">snd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">nTot</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="n">noise</span><span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">nTot</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">arange</span><span class="p">(</span><span class="n">frequency1</span><span class="p">,</span> <span class="n">frequency2</span><span class="o">+</span><span class="n">spacing</span><span class="p">,</span> <span class="n">spacing</span><span class="p">):</span>
        <span class="n">radFreq</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">f</span> 
        <span class="n">phase</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span>
        <span class="n">noise</span> <span class="o">=</span> <span class="n">noise</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">phase</span> <span class="o">+</span> <span class="p">(</span><span class="n">radFreq</span> <span class="o">*</span> <span class="n">timeAll</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Right&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">noise</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">noise</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">noise</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Left&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">noise</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">noise</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">noise</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&quot;Both&quot;</span><span class="p">:</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">noise</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">noise</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">noise</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span>
        <span class="n">snd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">noise</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nRamp</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">noise</span><span class="p">[</span><span class="n">nRamp</span><span class="p">:</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">]</span>
        <span class="n">snd</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">timeRamp</span><span class="o">/</span><span class="n">nRamp</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">noise</span><span class="p">[</span><span class="n">nRamp</span><span class="o">+</span><span class="n">nSamples</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">timeAll</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">snd</span>

 
   
</pre></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">pychoacoustics (&#39;0.2.52&#39;,) documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Samuele Carcagno.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>